!function(e) {
    function t() {
        return getComputedStyle(i)
    }
    function n(e) {
        return e && e.replace(/^[\s'"]|[\s'"]$/g, "")
    }
    var i = document.documentElement
      , o = i.attributes;
    e.checkMobile = e.checkMobile || {},
    e.checkMobile.css = e.checkMobile.css || {},
    e.checkMobile.css.isMobile = function() {
        return [o["data-mobile"].value, "attr(data-mobile)"].indexOf(n(t().content)) >= 0
    }
    ,
    e.checkMobile.css.isLandscape = function() {
        return /Mobi/i.test(navigator.userAgent) ? 90 === Math.abs(window.orientation) || screen.availHeight < screen.availWidth : [o["data-landscape"].value, "attr(data-landscape)"].indexOf(n(t().content)) >= 0
    }
}(peppers = peppers || {});
var peppers;
!function(e, t, n) {
    var i = t.userAgent || t.vendor || n.opera;
    e.checkMobile = e.checkMobile || {},
    e.checkMobile.isMobile = function() {
        return /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(i) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(i.substr(0, 4))
    }
    ,
    e.checkMobile.isMobileOrTablet = function() {
        return /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(i) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(i.substr(0, 4))
    }
}(peppers = peppers || {}, navigator, window);
var peppers;
!function(e, t) {
    function n() {
        var e = peppers.checkMobile.css.isMobile();
        i !== e && (i = e,
        o.trigger("check-mobile:change", i))
    }
    var i, o = e(t).on("resize", n);
    peppers.checkMobile = peppers.checkMobile || {},
    peppers.checkMobile.css = peppers.checkMobile.css || {},
    peppers.checkMobile.css.listen = function(e) {
        o.on("check-mobile:change", e),
        void 0 !== i && e(null, i)
    }
    ,
    n()
}(jQuery, window, peppers = peppers || {});
var peppers;
!function(e, t, n) {
    function i(e) {
        return $(e).is("[target='_blank']") || o(n.href.split("#").shift()) === o(e.href.split("#").shift())
    }
    function o(e) {
        if (/^(?:\w{3,}\:\/\/|\/frontend\/)/.test(e))
            return e;
        "/" == e.charAt(0) && (e = e.substr(1));
        var t = n.href.split("#").shift().split("/");
        return t.pop(),
        t.push(e),
        t.join("/")
    }
    function a(e) {
        return e.replace(/^\w+:\/\/[^\/]+/, "")
    }
    var r = $.Deferred()
      , s = [];
    e.ready = r.promise(),
    e.ready.addWait = function(e) {
        if (!e) {
            if (arguments.length > 0)
                return;
            var t = $.Deferred();
            e = t.promise()
        }
        return s.push(e),
        e.done(function() {
            s.splice(s.indexOf(e), 1),
            0 == s.length && r.resolve()
        }),
        t
    }
    ,
    $(t).one("page:out", function() {
        e.Transition.fadeIn()
    }),
    e.ready.done(function() {
        e.Transition.fadeOut();
        var n = e.Transition.getDelay();
        $(t).trigger("fade:start", n),
        setTimeout(function() {
            $(t).trigger("fade:complete")
        }, n)
    }),
    $(".menu__back-btn, .to-root").attr("href", o("/") + "#"),
    $(t.documentElement).on("click", "a", function(t) {
        if (i(this) || t.isDefaultPrevented())
            return !0;
        t.preventDefault(),
        e.navigateTo(this.href)
    }),
    e.navigateTo = function(t) {
        function i() {
            n.href = a(o(t))
        }
        e.Transition.opened ? (e.Transition.fadeIn(),
        setTimeout(i, 800)) : i()
    }
}(app = app || {}, document, location);
var app;
!function(e, t) {
    function n(e, t) {
        switch (typeof e) {
        case "number":
        case "string":
        case "boolean":
            return e === t;
        default:
            var i, o = [];
            for (i in e)
                if (o.push(i),
                !n(e[i], t[i]))
                    return !1;
            for (i in t)
                if (o.indexOf(i) < 0)
                    return !1;
            return !0
        }
    }
    function i(e, n) {
        if (!n)
            return t.hash = e || "/";
        t.replace("#" + (e || "/"))
    }
    function o(e) {
        return (e || t.hash).replace(/^#?\/?|\/$/, "").split("/")
    }
    e.hash = {
        getHash: o,
        isEqual: n,
        setHash: i
    }
}(peppers = peppers || {}, window.location);
var peppers;
!function(e) {
    e.jQueryConstructor = function(e, t) {
        return function(n) {
            var i = arguments;
            return this.each(function() {
                var n = $(this)
                  , o = n.data(e);
                o || n.data(e, o = new t(n)),
                "function" == typeof o.init && o.init.apply(o, i)
            })
        }
    }
}(peppers = peppers || {});
var peppers;
!function(e, t) {
    e.formatNumber = function(e) {
        for (var t = [], n = ("" + e).replace(/\s/g, ""); n.length > 0; )
            t.unshift(n.substr(-3)),
            n = n.substr(0, n.length - 3);
        return t.join(" ")
    }
    ,
    t && t.registerHelper("formatNumber", e.formatNumber)
}(peppers = peppers || {}, window.Handlebars);
var peppers;
!function(e, t) {
    t(e).ready(function() {
        function n(e) {
            l ? (f.beta = s(-(e.beta - l.beta) / 10, 1) * u,
            f.gamma = s((e.gamma - l.gamma) / 10, 1) * u) : (h.off("mousemove", i),
            l = {
                beta: e.beta,
                gamma: e.gamma
            })
        }
        function i(e) {
            var t = Math.ceil(d.width() / 2)
              , n = Math.ceil(d.height() / 2)
              , i = e.pageX - t
              , o = e.pageY - n;
            f.beta = o / n * u,
            f.gamma = -i / t * u
        }
        function o() {
            c.css({
                transform: "rotate3d(1, 0, 0, " + p.beta + "deg) rotate3d(0, 1, 0, " + p.gamma + "deg)"
            })
        }
        function a() {
            for (var e in p)
                p[e] += (f[e] - p[e]) * m[e]
        }
        function r() {
            requestAnimationFrame(r),
            v(),
            g(p)
        }
        function s(e, t) {
            return t = Math.abs(t),
            e < -t ? -t : e > t ? t : e
        }
        var c = t(".parallax__container");
        if (0 != c.length) {
            var l, u = 14, d = t(e.body), h = t(e.documentElement);
            h.mousemove(i),
            peppers.accelerometer.on("change", n);
            var f = {
                beta: 0,
                gamma: 0
            }
              , p = {
                beta: 0,
                gamma: 0
            }
              , m = {
                beta: .05,
                gamma: .05
            }
              , g = o
              , v = a;
            r()
        }
    })
}(document, jQuery),
function(e, t) {
    function n() {
        c && (c = !1,
        t.removeEventListener("deviceorientation", o, !0),
        t.removeEventListener("devicemotion", o, !0),
        t.removeEventListener("MozOrientation", o, !0))
    }
    function i() {
        c || (c = !0,
        t.DeviceOrientationEvent ? t.addEventListener("deviceorientation", o, !0) : t.DeviceMotionEvent ? t.addEventListener("devicemotion", o, !0) : t.addEventListener("MozOrientation", o, !0))
    }
    function o(e) {
        switch (e.type) {
        case "deviceorientation":
            a(e.beta, e.gamma);
            break;
        case "devicemotion":
            a(2 * e.acceleration.x, 2 * e.acceleration.y);
            break;
        case "MozOrientation":
            a(50 * orientation.x, 50 * orientation.y)
        }
    }
    function a(e, t) {
        (e || t) && r("change", {
            beta: e,
            gamma: t
        })
    }
    function r(e, t) {
        for (var n = 0; l[e] && n < l[e].length; n++)
            l[e][n](t)
    }
    function s(e, t) {
        return (l[e] = l[e] || []).indexOf(t)
    }
    var c, l = {};
    e.accelerometer = {
        on: function(e, t) {
            s(e, t) < 0 && "function" == typeof t && l[e].push(t),
            l[e].length > 0 && i()
        },
        off: function(e, t) {
            var i = s(e, t);
            i >= 0 && l[e].splice(i, 1),
            (l[e].length = 0) && n()
        }
    }
}(peppers = peppers || {}, window);
var peppers;
!function(e) {
    function t(t) {
        function n(t) {
            r.toggleClass("pep-placeholder__text_hidden", "keypress" == t.type || !!e(this).val())
        }
        function i() {
            var e = o();
            return t.data("placeholder", e),
            t.attr("placeholder", ""),
            e
        }
        function o() {
            return t.attr("placeholder") || t.data("placeholder")
        }
        var a, r;
        this.init = function(o) {
            this.destroy();
            var s = i();
            t.wrap("<div class='pep-placeholder'></div>"),
            r = e("<div class='pep-placeholder__text'>" + (e.isFunction(o) ? o(s) || "" : s) + "</div>").insertBefore(t).addClass(t.get(0).className),
            t.addClass("pep-placeholder__input"),
            a = t.parent(),
            t.on("keypress  keyup  change  input:empty", n)
        }
        ,
        this.destroy = function() {
            a && (a.after(t),
            a.remove(),
            a = void 0),
            t.removeClass("pep-placeholder__input");
            var e = o();
            t.data("placeholder", ""),
            t.attr("placeholder", e),
            t.off("keypress  keyup  change  input:empty", n)
        }
    }
    e.fn.pepPlaceholder = function(n) {
        this.each(function() {
            var i = e(this)
              , o = i.data("pepPlaceholder");
            o || i.data("pepPlaceholder", o = new t(i)),
            o.init(n)
        })
    }
}(jQuery),
function(e) {
    function t(e, t) {
        this.x = e,
        this.y = t
    }
    t.prototype.subtract = function(e) {
        return new t(this.x - e.x,this.y - e.y)
    }
    ,
    t.prototype.add = function(e) {
        return new t(this.x + e.x,this.y + e.y)
    }
    ,
    t.prototype.length = function() {
        return Math.sqrt(this.x * this.x + this.y * this.y)
    }
    ,
    t.prototype.distance = function(e) {
        return this.subtract(e).length()
    }
    ,
    t.prototype.toString = function() {
        return "[Point(" + this.x + ", " + this.y + ")]"
    }
    ,
    t.distance = function(e, t) {
        return t.subtract(e).length()
    }
    ,
    t.prototype.clone = function() {
        return new t(this.x,this.y)
    }
    ,
    e.Point = t
}(peppers = peppers || {});
var peppers;
!function(e) {
    function t(e) {
        var t = $.Deferred()
          , n = $("<img/>").addClass("image-preloader");
        return n.attr("crossOrigin", "Anonymous"),
        n.on("load", function() {
            t.resolve(n)
        }),
        n.on("error", function(e) {
            t.reject(e)
        }),
        n.attr("src", e),
        $(document.body).append(n),
        t.promise()
    }
    function n(e, t) {
        var n = $(e).width()
          , i = $(e).height();
        t = t || {},
        t.width = t.width || n,
        t.height = t.height || i;
        var o = Math.min(1, t.width / n, t.height / i);
        t.width = Math.round(n * o),
        t.height = Math.round(i * o);
        var a = document.createElement("canvas");
        a.width = t.width,
        a.height = t.height;
        var r = a.getContext("2d");
        return r.drawImage(e.get(0), 0, 0, n, i, 0, 0, t.width, t.height),
        {
            width: t.width,
            height: t.height,
            data: r.getImageData(0, 0, t.width, t.height).data
        }
    }
    e.load = t,
    e.getImageData = n
}(peppers = peppers || {});
var peppers;
!function(e) {
    e.trimText = function(e, t, n) {
        n = n || 1;
        var i = []
          , o = e.split(/\r?\n/g);
        if (t = Math.max(t, e.length / n),
        o.length > 1)
            for (var a = 0; a < o.length; a++)
                o.splice(a, 1, trimText(o[a], t));
        else
            for (o = e.split(" "); o.length > 0; ) {
                var r = []
                  , s = 0;
                do {
                    var c = o.shift();
                    s += c.length,
                    r.push(c)
                } while (o.length > 0 && s + .5 * o[0].length < t);o.length > 0 && r.length > 1 && ["a", "the", "is", "of"].indexOf(r[r.length - 1].toLowerCase()) >= 0 && o.unshift(r.pop()),
                i.push(r.join(" "))
            }
        return i
    }
}(app = app || {});
var app;
!function(e, t) {
    function n() {
        var e = $(t.body)
          , n = Math.max(e.width(), screen.width)
          , o = Math.max(e.height(), screen.height)
          , a = $(".transition-wrapper");
        0 == a.length && (a = $("<div class='transition-wrapper'>"),
        e.append(a));
        for (var r = n / 10 + 1, s = 100 / 86.55 * r + 1, c = [], l = {}, u = 0, d = 0, h = -s / 2; h < o + s / 2; h += .75 * s - 1) {
            d = 0;
            for (var f = -r / 2; f < n + r / 2; f += r - 1) {
                var p = $("<div class='transition-hexagon-bg'><div class='transition-hexagon'>");
                c.push(p),
                a.append(p);
                var m = u % 2 == 0;
                p.css({
                    width: r + "px",
                    height: s + "px",
                    left: f - (m ? r / 2 : 0) + "px",
                    top: h + "px"
                }),
                d++
            }
            u++
        }
        $("<div></div>").addClass("transition__preloader").appendTo(a),
        a.addClass("transition-wrapper_initialized"),
        this.opened = !1,
        this.fadeIn = function() {
            this.opened = !1,
            $.each(c, i(!0, l))
        }
        ,
        this.fadeOut = function() {
            this.opened = !0,
            $.each(c, i(!1, l)),
            a.addClass("transition-wrapper_fade-out")
        }
        ,
        this.getDelay = function() {
            return 800 + l.delay
        }
    }
    function i(e, t) {
        return t.delay = 0,
        function() {
            var n = $(this)
              , i = Math.round(30 * Math.random() * 20);
            t.delay = Math.max(t.delay, i),
            setTimeout(function() {
                n.toggleClass("transition-hexagon_a-out", !e).toggleClass("transition-hexagon_a-in", e)
            }, i)
        }
    }
    e.Transition = new n
}(app = app || {}, document);
var app;
!function(e) {
    function t() {
        function e() {
            r.css("height", $(this).outerHeight() + parseInt(r.css("paddingTop")) + parseInt(r.css("paddingBottom")))
        }
        var t = $(this).parent()
          , n = t.find(".checkbox-nth")
          , i = n.index(this)
          , o = t.find(".checkbox-nth-item");
        o.off("checkbox:change");
        var a = o.eq(i).on("checkbox:change", e)
          , r = t.find(".checkbox-nth-container");
        r.css({
            height: a.outerHeight() + parseInt(r.css("paddingTop")) + parseInt(r.css("paddingBottom"))
        }),
        setTimeout(function() {
            var e = t.find(".checkbox-nth-container");
            e.css({
                height: a.outerHeight() + parseInt(e.css("paddingTop")) + parseInt(e.css("paddingBottom"))
            })
        }, 50)
    }
    $(e.documentElement).on("change", ".checkbox-nth", t)
}(document),
function(e, t, n, i, o, a) {
    function r() {
        var n = e.hash.getHash()
          , r = {
            brief: "brief-modal",
            alert: "modal-message",
            "faq-addwork": "faq",
            faq: "faq-2",
            "terms-accepted": "terms-accepted"
        }
          , s = []
          , l = a.user.getData();
        if (("modal" !== n[0] || "modal" === n[0] && "terms" !== n[1]) && "modal" === n[0] && "terms-accepted" !== n[1] && l && l.user && !1 === l.user.terms_accepted)
            return void e.modal("terms-accepted");
        if ("modal" === n[0] && "terms-accepted" === n[1] && l && l.user && !0 === l.user.terms_accepted)
            return void a.navigateTo("/");
        if ("modal" === n[0]) {
            var u = r[n[1]] || n[1];
            if ("add-prediction" != u || a.user.isAuthorized() ? ("login" === n[1] && d && (t(i.documentElement).off("modal:hide"),
            t(i.documentElement).on("modal:hide", function() {
                e.hash.setHash("")
            })),
            c(u, n, s.indexOf(u) >= 0)) : (d = !1,
            e.modal("login", [o.hash, function() {
                a.user.isAuthorized() && (d = !0,
                e.hash.setHash("/modal/add-prediction"),
                t(i.documentElement).off("modal:hide"))
            }
            ])),
            "search" === n[1]) {
                var h = t(".modal__ui.search .search__form");
                if ("tag" === n[2] && n[3]) {
                    var f = decodeURI(n[3]);
                    "competition" === f && (f = 'конкурс &nbsp(<a class="contest_link" target="_blank" href=\'https://www.app.ru/blog/earth-2050-contest/20089/\'>победители</a>)'),
                    t(".tag_search").html(f),
                    h.trigger("search:tag")
                } else if ("text" === n[2] && n[3]) {
                    var p = decodeURI(n[3])
                      , m = t(".search__input");
                    m.val(p),
                    h.trigger("submit")
                } else
                    h.trigger("reset")
            }
        } else
            t(i.documentElement).off("modal:hide"),
            c()
    }
    function s(e) {}
    function c(e, n, o) {
        if (l.toggleClass("modal_over-hamburger", !!o),
        u.toggleClass("modal__close-button_over-hamburger", !!o),
        e)
            var a = l.find("." + e);
        l.find(".modal__ui").filter(".modal__ui_visible").not(a).removeClass("modal__ui_visible").trigger("modal-item:hide");
        var r = !!a && a.length > 0;
        return l.find(".backdrop").toggleClass("backdrop_visible", r),
        l.toggleClass("modal_visible", r),
        a && (a.trigger("modal-item:change", n),
        u.filter(".modal > .modal__close-button").toggle(!a.is("[data-no-close]")),
        a.is("modal__ui_visible") || (a.addClass("modal__ui_visible"),
        a.trigger("modal-item:show"))),
        t(i.documentElement).trigger("modal:toggle").trigger("modal:" + (r ? "show" : "hide")),
        a
    }
    t(n).on("hashchange", r),
    t(i.documentElement).on("menu:toggle", s);
    var l = t(".modal").not(".modal_static")
      , u = l.find(".modal__close-button")
      , d = !0;
    u.on("click", function(e) {
        var n = new t.Event("modal:close");
        l.trigger(n),
        n.isDefaultPrevented() && e.preventDefault()
    }),
    e.modal = function(n, a) {
        function r(e) {
            switch (typeof e) {
            case "string":
                o.replace(e);
                break;
            case "function":
                e();
                break;
            case "object":
                e.length && e.forEach(r)
            }
        }
        e.hash.setHash(n ? "/modal/" + n : ""),
        t(i.documentElement).off("modal:hide"),
        a && t(i.documentElement).on("modal:hide", function() {
            r(a)
        })
    }
}(peppers = peppers || {}, jQuery, window, document, window.location, app);
var peppers;
!function(e, t) {
    function n(e) {
        return e.reduce(function(e, t) {
            return e[t.name] = t.value,
            e
        }, {})
    }
    function i(t) {
        function i(t, n) {
            function i() {
                t.removeClass("form__wrong").off("focus change keydown", i)
            }
            if (o = o || [],
            n)
                try {
                    var a = e.fn.localization.getText(n);
                    o.push(a)
                } catch (e) {}
            t.addClass("form__wrong").on("focus change keydown", i)
        }
        var o, a = n(t.serializeArray());
        return t.find("[data-required], [data-min-length], [data-equal], [data-chars], [data-email]").each(function() {
            var n = e(this)
              , o = n.attr("name")
              , r = a[o]
              , s = n.data();
            if (s.hasOwnProperty("required") && !r)
                i(n, s.errorRequired);
            else
                e: for (var c in s)
                    if (s.hasOwnProperty(c))
                        switch (c) {
                        case "minLength":
                            var l = ~~s.minLength;
                            r && r.length < l && i(n, s.errorMinLength);
                            break e;
                        case "equal":
                            r != a[s.equal] && i(n.add(t.find("[name='" + s.equal + "']")), s.errorNotEqual);
                            break e;
                        case "chars":
                            var u = new RegExp("^[" + s.chars.replace(/(\])/g, "\\$1") + "]*$");
                            u.test(r) || i(n, s.errorChars);
                            break e;
                        case "email":
                            var u = /\S+@\S+\.[a-zA-Z]+/;
                            u.test(r) || i(n, s.errorEmail);
                            break e
                        }
        }),
        o
    }
    e(t).on("submit", ".form_validate", function(t) {
        var n = i(e(this));
        if (n)
            return n.join("").length > 0 && app.alert("<p>" + n.join("</p><p>") + "</p>"),
            void t.preventDefault();
        var o = new e.Event("form:submit");
        e(this).trigger(o),
        o.isDefaultPrevented && t.preventDefault()
    })
}(jQuery, document.documentElement),
function(e, t, n) {
    function i(e) {
        var t = e.find(".clip-path rect, .back-btn-svg__mask rect");
        t.attr({
            y: "50%",
            height: "0%"
        });
        var i = {
            height: 0
        };
        e.hover(function(e) {
            var a = o[e.type];
            n.to(i, a.duration, {
                height: a.tween.height,
                ease: a.tween.ease,
                onUpdate: function() {
                    t.attr({
                        y: 50 - .5 * i.height + "%",
                        height: i.height + "%"
                    })
                }
            })
        })
    }
    var o = {
        mouseenter: {
            duration: .4,
            tween: {
                ease: Sine.easeOut,
                height: 102
            }
        },
        mouseleave: {
            duration: .2,
            tween: {
                ease: Sine.easeIn,
                height: 0
            }
        }
    };
    e.fn.hexButton = t.jQueryConstructor("hexButton", i)
}(jQuery, peppers = peppers || {}, TweenLite);
var peppers;
!function(e, t) {
    function n() {
        clearInterval(c);
        var t = e(this).is(":checked");
        t || (c = setInterval(o, g),
        o()),
        i(t),
        e.cookie("muted", t ? 1 : 0, {
            path: "/",
            expires: 3650
        });
        var n = e(".sound").get(0);
        void 0 !== localStorage.sound_progress && (n.currentTime = parseFloat(localStorage.sound_progress)),
        n.ontimeupdate = function() {
            localStorage.sound_progress = n.currentTime
        }
    }
    function i(e) {
        e ? f.get(0).pause() : f.get(0).play()
    }
    function o() {
        for (var e = r(), t = 0; t < h.length; t++)
            h[t].css("height", 100 * e(t / (h.length - 1)) + "%")
    }
    function a(e, t) {
        return t ? t + e[0].toUpperCase() + e.substr(1) : e
    }
    function r() {
        for (var e = [], t = 1 + 6 * Math.random(), n = 2 * Math.random() * Math.PI; e.length < t; )
            e.push(s(n));
        return function(t) {
            for (var n = 0, i = 0; i < e.length; i++)
                n += e[i](t);
            return .5 + n / e.length * .5
        }
    }
    function s(e) {
        var t = 2 * Math.floor(1 + 3 * Math.random()) * Math.PI;
        return function(n) {
            return Math.sin(e + n * t)
        }
    }
    for (var c, l = e(".mute-btn_false"), u = l.find("label"), d = [1, 2, 3, 7, 18, 11, 25, 13, 26, 47, 26, 18, 25, 11, 18, 7, 3, 2, 1], h = [], f = e(".sound", top.document), p = 0; p < d.length; p++) {
        var m = e("<span></span>").addClass("mute-btn__line");
        h.push(m),
        m.appendTo(u).after(" ").css("height", d[p] / .47 + "%")
    }
    var g = function(e) {
        for (var t, n = ["", "webkit", "moz", "ms", "o"], i = 0; !t && i < n.length; i++)
            t = e[a("transitionDuration", n[i])];
        var o = /((?:\d*\.)?\d+)(m?s)/.exec(t || "0s")
          , r = parseFloat(o[1]);
        switch (o[2]) {
        case "s":
            return 1e3 * r;
        default:
        case "ms":
            return r
        }
    }(getComputedStyle(m.get(0)));
    l.find(".mute-btn__checkbox").change(n).prop("checked", 1 === parseInt(e.cookie("muted"))).change()
}(jQuery, document),
function(e, t) {
    function n(n) {
        function i() {
            e(t).off("resize", a).on("resize", a),
            n.off("scroll:refresh", a).on("scroll:refresh", a),
            a()
        }
        function o() {
            e(t).off("resize", a),
            n.off("scroll:refresh", a)
        }
        function a(e) {
            var t = {
                width: n.width(),
                height: n.height()
            };
            n.siblings(".scroll-mask").find("rect").attr(t)
        }
        n.on("scroll:show", i).on("scroll:hide", o)
    }
    e.fn.scrollCustom = function() {
        this.each(function() {
            var t = e(this);
            t.data("scrollCustom") || t.data("scrollCustom", new n(t))
        })
    }
}(jQuery, window),
function(e, t) {
    function n(e) {
        function n() {
            return s = new IScroll(e.get(0),{
                scrollX: !1,
                scrollbars: "custom",
                mouseWheel: !0,
                momentum: !1,
                disableMouse: !0,
                disablePointer: !0,
                disableTouch: !1,
                bindToWrapper: !0
            }),
            s.on("refresh", r),
            s.on("scrollStart", o),
            s.on("scrollEnd", a),
            s.on("scrollCancel", i),
            e.parent().append(c = e.find(".iScrollLoneScrollbar")),
            this
        }
        function i() {
            clearInterval(l)
        }
        function o() {
            var t = this;
            l = setInterval(function() {
                0 == t.y && -1 == t.directionY ? e.trigger("scroll:top") : t.hasVerticalScroll && e.trigger("scroll:scrolled")
            }, 50),
            this.y - this.maxScrollY < 50 && e.trigger("scroll:bottom")
        }
        function a() {
            clearInterval(l),
            0 === this.y && e.trigger("scroll:top"),
            this.y - this.maxScrollY < 50 && e.trigger("scroll:bottom")
        }
        function r() {
            0 === this.y ? e.trigger("scroll:top") : e.trigger("scroll:scrolled"),
            e.closest(".scroll").trigger("scroll:refresh"),
            s.hasVerticalScroll ? s.indicators[0].wrapper.classList.remove("is-disabled") : s.indicators[0].wrapper.classList.add("is-disabled")
        }
        var s, c, l;
        e.find("a").on("click", function(e) {
            s && s.moved && e.preventDefault()
        }),
        this.scrollTo = function(e) {
            return s && s.scrollTo(0, e, 200),
            this
        }
        ,
        this.refresh = function() {
            return t.checkMobile.css.isMobile() ? (s && (s.destroy(),
            c.remove()),
            s = void 0) : s || n(),
            s && s.refresh(),
            this
        }
    }
    e.fn.scrollbarCustom = t.jQueryConstructor("scrollCustom", n)
}(jQuery, peppers = peppers || {});
var peppers;
!function(e, t, n, i, o) {
    function a(e, t) {
        function n() {
            var e = .5 * t;
            i(r, e, .5),
            i(s, e, .5),
            i(h, e + .25, .3),
            i(f, e + .45, .3),
            i(p, e + .35, .2),
            i(m, e + .4, .2)
        }
        function i(e, t, n, i, a) {
            e.css("transform", i || "scale(0)"),
            o.to(e.get(0), n || .5, {
                transform: a || "scale(1)",
                delay: t
            })
        }
        function a() {
            o.to(e.get(0), .3, {
                transform: "scale(0)",
                onComplete: function() {
                    e.trigger(d)
                }
            })
        }
        e.click(function() {
            e.trigger(u, t)
        });
        var r = e.find(".earth-popup__preview-hexagon")
          , s = e.find(".earth-popup__item-shadow")
          , h = e.find(".earth-popup__flag-hexagon")
          , f = e.find(".hexagon-svg")
          , p = e.find(".earth-popup__city")
          , m = e.find(".earth-popup__briefs-count");
        this.init = function(e) {
            switch (e) {
            case c:
                n();
                break;
            case l:
                a()
            }
        }
    }
    var r, s, c = "show", l = "hide", u = "item:select", d = "item:remove";
    i.fn.earthPopupItem = function(e) {
        return this.each(function(t, n) {
            var o = i(this)
              , r = o.data("earthPopupItem");
            r || o.data("earthPopupItem", r = new a(o,t)),
            r.init(e)
        })
    }
    ,
    e.getHexaspherePopup = function(e, n) {
        var o, a;
        return r || (s = i("#earth-popup[type='text/x-handlebars-template']"),
        r = t.compile(s.html())),
        o = i(r(e)).appendTo(s.parent()),
        o.localization("en"),
        a = o.find(".earth-popup__item").on(u, function(t, i) {
            n(e[i])
        }).on(d, function() {
            o.remove(),
            o = void 0,
            a = void 0
        }).earthPopupItem(c),
        {
            element: o.get(0),
            action: function(e) {
                o && o.toggleClass("earth-popup_moving", !0 === e || "mousedown" === e)
            },
            close: function() {
                a && a.earthPopupItem(l),
                a = void 0
            }
        }
    }
}(app = app || {}, Handlebars, document, jQuery, TweenLite);
var app;
!function(e, t, n, i) {
    function o(i) {
        function o(n, i) {
            function o() {
                _ = !0,
                k = void 0,
                y = w - Math.floor(w) > .1 ? .04 : 0
            }
            function a() {
                v = !0,
                _ = !1,
                k || (h(),
                n.on("mousemove", r))
            }
            function r(e) {
                var t = l.parent().offset()
                  , n = e.pageX - t.left
                  , i = e.pageY - t.top
                  , o = Math.atan2(i, n) / Math.PI
                  , a = o < .25 && o > -.5 ? 1 : 0
                  , r = Math.abs(w - Math.floor(w));
                y = a * Math.min(1, Math.max(0, Math.sqrt(n * n + i * i) - 80 * (1 - r)) / 160) * .08
            }
            function d() {
                y = 0,
                n.off("mousemove", r),
                cancelAnimationFrame(k),
                k = void 0
            }
            function h() {
                k = requestAnimationFrame(h),
                g()
            }
            function p() {
                l && (l.off().remove(),
                u.splice(u.indexOf(l), 1)),
                b = void 0,
                l = void 0
            }
            function m() {
                p(),
                c.css(s(void 0)),
                c.each(function() {
                    f.append(this)
                })
            }
            function g() {
                _ && Math.floor(w) != Math.floor(w + y) ? (w = Math.ceil(w),
                d()) : w += y;
                var t = Math.floor(w)
                  , n = w - t
                  , o = ((i - 1 - t) % i + i) % i;
                if (!l || o !== b)
                    for (p(),
                    b = o,
                    l = e(c.eq(b).clone()),
                    l.addClass("HELPER"),
                    u.splice(o, 0, l),
                    r = o + 1; r < o + 1 + u.length; r++)
                        f.append(u[r % u.length]);
                for (var a = u.length, r = 0; r < a; r++) {
                    var h = ((o + 1 + r) % a + a) % a
                      , m = u[h];
                    m && m.css(s(r + n))
                }
            }
            var v, _, b, k, w = 0, y = 0;
            t.checkMobile.css.listen(function(e, t) {
                var i = t ? n.off : n.on;
                i.apply(n, ["mouseover", a]),
                i.apply(n, ["mouseleave", o]),
                t ? m() : g()
            })
        }
        function r(t, n, i) {
            var o = e.extend({}, t, n);
            for (var a in o)
                o.hasOwnProperty(a) && (o[a] = t[a] + (n[a] - t[a]) * i);
            return o
        }
        function s(e) {
            if (void 0 === e)
                return {
                    transform: "",
                    opacity: "",
                    filter: ""
                };
            var t = Math.floor(e)
              , n = Math.ceil(e);
            if (n >= a.length || t < 0)
                return {
                    display: "none"
                };
            var i = r(a[t], a[n], e - t);
            return {
                display: "",
                transform: "scale(" + i.scale + ") translate(" + i.x + "px," + i.y + "px)",
                opacity: i.opacity,
                filter: "brightness(" + i.brightness + ")"
            }
        }
        var c, l, u = [], d = this, h = i.find(".best-of-week__decor-hexagon"), f = i.find(".best-of-week__carousel"), p = i.find(".backdrop"), m = i.find('[type="text/x-handlebars-template"]'), g = Handlebars.compile(m.html());
        !function(t) {
            function o() {
                r();
                var t = (e(i).find(".best-of-week__modal").css("display", "block"),
                h.find(".best-of-week__item"));
                if (TweenLite.killTweensOf(h.get(0)),
                TweenLite.killTweensOf(t.get(0)),
                h.css("opacity", 0),
                t.css({
                    opacity: "",
                    fontSize: ""
                }),
                TweenLite.to(h.get(0), .35, {
                    opacity: 1,
                    delay: .3,
                    ease: new Ease(function(e, t, n, i) {
                        return ~~(Math.abs(e - .2) < .1 || Math.abs(e - .55) < .05 || Math.abs(e - .75) < .05 || Math.abs(e - .9) < .1)
                    }
                    ),
                    onComplete: function() {
                        TweenLite.to(t.get(0), .1, {
                            opacity: 0,
                            fontSize: 0,
                            ease: Sine.easeIn
                        })
                    }
                }),
                c) {
                    c.css("fontSize", "");
                    var n = c.css("fontSize");
                    c.css({
                        fontSize: 0,
                        opacity: 0
                    }),
                    c.each(function(e) {
                        var t = this;
                        TweenLite.killTweensOf(t),
                        TweenLite.to(t, .3, {
                            fontSize: parseFloat(n),
                            opacity: 1,
                            delay: .5 + .03 * e,
                            onComplete: function() {
                                this.target.style.fontSize = "",
                                this.target.style.opacity = ""
                            }
                        })
                    })
                }
            }
            function a() {
                var t = e(i).find(".best-of-week__modal").css("display", "block")
                  , n = h.find(".best-of-week__item");
                TweenLite.killTweensOf(h.get(0)),
                TweenLite.killTweensOf(n.get(0)),
                h.css("opacity", 0),
                n.css({
                    opacity: "",
                    fontSize: 100
                }),
                TweenLite.to(h.get(0), .15, {
                    opacity: .3,
                    ease: new Ease(function(e) {
                        return Math.sin(e * Math.PI)
                    }
                    ),
                    delay: .15
                }),
                TweenLite.to(n.get(0), .15, {
                    fontSize: 600,
                    delay: .15,
                    ease: Sine.easeOut,
                    onComplete: function() {
                        t.css("display", ""),
                        r()
                    }
                }),
                c && c.each(function(t) {
                    var n = this;
                    TweenLite.killTweensOf(n),
                    TweenLite.to(n, .3, {
                        fontSize: 50,
                        opacity: 0,
                        onComplete: function() {
                            e(n).css({
                                fontSize: "",
                                opacity: ""
                            })
                        }
                    })
                })
            }
            function r() {
                e(n.documentElement).trigger("best-of-week:toggle")
            }
            t.on("change", function() {
                var t = e(this).is(":checked");
                p.toggleClass("backdrop_visible", t),
                t ? o() : a()
            }).change()
        }(i.find("#best-of-week__checkbox")),
        d.init = function(t) {
            function n(t) {
                c = e(g(t)).filter(".best-of-week__item-container"),
                f.append(c),
                c.each(function(t) {
                    u.push(e(this).css("animationDelay", 1 + .1 * t + "s"))
                }),
                o(i, c.length)
            }
            c && c.off().remove(),
            c = void 0,
            u.length = 0,
            t.done(n)
        }
    }
    var a = [{
        scale: .65,
        x: 238,
        y: -181,
        opacity: 0,
        brightness: .3
    }, {
        scale: .75,
        x: 155,
        y: -141,
        opacity: 1,
        brightness: .3
    }, {
        scale: .84,
        x: 66,
        y: -80,
        opacity: 1,
        brightness: .45
    }, {
        scale: 1,
        x: 0,
        y: 0,
        opacity: 1,
        brightness: 1
    }, {
        scale: 1.2,
        x: -40,
        y: 130,
        opacity: 1,
        brightness: 0
    }];
    e.fn.bestOfWeek = function(t) {
        function n(e) {
            e = e.list || [];
            for (var t = 0; t < e.length; t++) {
                var n = app.trimText(e[t].name || e[t].title || "", 8, 3);
                e[t].name = n,
                e[t].multiline = n.length > 1 ? "multiline" : "singleline",
                e[t].link = app.brief_link(e[t].brief_id, e[t].works_count || e[t].works || 1)
            }
            return e
        }
        var i;
        return this.each(function() {
            var a = e(this)
              , r = a.data("bestOfWeek");
            r || a.data("bestOfWeek", r = new o(a)),
            r.init(i = i || t("", n))
        }),
        this
    }
}(window.jQuery, peppers = peppers || {}, document, window);
var peppers;
!function(e, t, n, i, o) {
    function a(e) {
        function a() {
            x.scaleX = x.scaleY = Math.min(1, e.height() / b.height),
            x.update()
        }
        function s() {
            for (var e = 0; e < m.length; e++)
                m[e]._redraw();
            x.update()
        }
        function c(e, t) {
            for (var n = 0; n < m.length; n++)
                m[n].mouse(e, t)
        }
        function l(e) {
            c(0, 9999999)
        }
        function u(e) {
            var n = t(this).offset();
            c(e.pageX - n.left - x.x, e.pageY - n.top - x.y)
        }
        function d(e, n, i) {
            var o = []
              , a = (b.height - 1) / e;
            a = Math.round((a - n.length) / (n.length - 1));
            var s = a + 1;
            a = a * (n.length - 1) + n.length,
            e = (b.height - 1) / (a - 1);
            var c;
            p = n.map(function(e, n, o) {
                var a = t(w(e)).insertBefore(k);
                if (n < o.length - 1)
                    for (var s = 0; s < 11; s++)
                        a.after(" <span class='timeline__dash'></span> ");
                var c = new r.Year(b.width,e,a.get(0));
                return e == i && f(c),
                c.addEventListener("__select", h),
                c
            });
            for (var l = [].concat(p), u = 0; u < a; u++)
                c = u % s == 0 ? l.shift() : new r.Dash(b.width),
                o.push(c),
                c.y = Math.round(e * u),
                x.addChild(c);
            return o
        }
        function h(t) {
            var n = t.currentTarget;
            if (n && v) {
                var o = v[n.year];
                if (o && o.length > 0) {
                    var a = Math.floor(Math.random() * o.length);
                    return void ("#" === o[a].substr(0, 1) ? i.location.hash = o[a] : app.navigateTo(o[a]))
                }
            }
            e.is(".timeline_static") || f(t.currentTarget)
        }
        function f(n) {
            if (g != n) {
                var o = i.currentYear = ~~n.yearNum[0].innerText
                  , a = i.PLANET;
                a && a.state == a.IDLE && a.showYear(o),
                g && g.setSelected(!1),
                g = n,
                g.setSelected(!0),
                t(e).trigger("timeline:change", o)
            }
        }
        var p, m, g, v, _ = !e.is(".timeline_static"), b = {
            width: 40,
            height: 360
        }, k = e.find("[type='text/x-handlebars-template']"), w = Handlebars.compile(k.html()), y = function(e, n, i) {
            var a = e.find("canvas");
            return 0 == a.length && (a = t(o.createElement("canvas")),
            e.prepend(a)),
            a.attr({
                width: n,
                height: i
            }),
            a
        }(e, b.width, b.height), x = new n.Stage(y.get(0));
        b.height -= 20,
        x.y = 10,
        this.init = function(i, r) {
            m = d(8, i, r),
            x.enableMouseOver(25),
            x.update(),
            _ ? (e.on("mousemove", u),
            e.on("mouseleave", l),
            n.Ticker.addEventListener("tick", s)) : (t(o.documentElement).on("resize:after", a),
            a())
        }
        ,
        this.initLinks = function(t, i) {
            var o = !!(t && t.length > 0);
            t && (v = t.reduce(function(e, t) {
                e[t.year] = e[t.year] || [];
                var n = null;
                if (i) {
                    var o = t.works.find(function(e) {
                        return e.author && e.author.id == i
                    });
                    n = o ? o.id : null
                }
                return e[t.year].push(app.brief_link(t.id, t.works_count, n)),
                e
            }, {}),
            p.forEach(function(e) {
                e.setActive(v && v[e.year] && v[e.year].length > 0)
            })),
            e.toggleClass("timeline_static", !o),
            o ? (e.on("mousemove", u),
            e.on("mouseleave", l),
            n.Ticker.addEventListener("tick", s)) : (e.off("mousemove", u),
            e.off("mouseleave", l),
            setTimeout(function() {
                n.Ticker.removeEventListener("tick", s)
            }, 1e3))
        }
    }
    var r = {};
    t.fn.pepTimeline = e.jQueryConstructor("$timeline", a),
    function(e) {
        function t(e) {
            this.Container_constructor(),
            this.distance = this.currentDistance = 0;
            var t = this.dash = new n.Shape;
            t.graphics.beginLinearGradientFill(["rgba(77, 193, 148, 1)", "rgba(77, 193, 148, 0)"], [.65, 1], 0, 0, e, 0).drawRect(0, 0, e, 1),
            t.alpha = .53,
            this.addChild(t),
            t.x = 13 - e
        }
        var i = n.extend(t, n.Container);
        i.mouse = function(e, t) {
            this.initDistance(this.getDistance(e, t))
        }
        ,
        i.getDistance = function(e, t) {
            var n = Math.abs(t - this.y);
            return (n = Math.max(0, 1 - n / 48)) * n
        }
        ,
        i.initDistance = function(e) {
            this.distance = e
        }
        ,
        i._redraw = function() {
            var e = this.currentDistance = this.currentDistance + .5 * (this.distance - this.currentDistance);
            this.dash.alpha = .53 + .47 * e,
            this.x = 12 * e
        }
        ,
        e.Dash = n.promote(t, "Container")
    }(r),
    function(e) {
        function i(e, i, o) {
            this.Dash_constructor(e),
            this.year = i,
            this.yearNum = t(o);
            var a = new n.DOMElement(this.yearNum.get(0));
            a.x = 20,
            this.dash.x = this.dash.x + 7,
            this.dash.alpha = 1,
            this.addChild(a);
            var r = this.img = new n.Bitmap("images/timeline/selected-glow.png");
            r.alpha = 0,
            this.addChild(r),
            r.x = this.dash.x,
            r.y = -6;
            var s = this;
            this.yearNum.on("click", function() {
                !1 === s.isActive || s.selected || s.dispatchEvent(new n.Event("__select"))
            })
        }
        var o = n.extend(i, e.Dash);
        o.setActive = function(e) {
            this.isActive = !!e,
            this.yearNum.toggleClass("timeline__item_inactive", !this.isActive)
        }
        ,
        o._redraw = function() {
            this.selected || !1 === this.isActive || (this.Dash__redraw(),
            this.dash.alpha = 1,
            this.yearNum.css({
                fontSize: 14 + 10 * this.currentDistance
            }))
        }
        ,
        o.toggleSelected = function() {
            return this.setSelected(!this.selected),
            this
        }
        ,
        o.getSelected = function() {
            return this.selected
        }
        ,
        o.setSelected = function(e) {
            this.selected = e;
            var t, i, o;
            e ? (t = {
                color: "#00ffa7",
                fontWeight: 900,
                fontSize: 24
            },
            o = 20,
            i = 1) : (t = {
                color: "#ffffff",
                fontWeight: 500
            },
            o = 0,
            i = 0),
            this.yearNum.animate(t, 200),
            n.Tween.get(this.img).to({
                alpha: i
            }, 200),
            n.Tween.get(this).to({
                x: o
            }, 200),
            this.yearNum.toggleClass("timeline__item-selected", e),
            this.dash.filters = []
        }
        ,
        e.Year = n.promote(i, "Dash")
    }(r)
}(peppers = peppers || {}, jQuery, createjs, window, document);
var peppers;
!function(e, t, n, i, o) {
    function a(o) {
        function a(e, t) {
            b.briefCommentsList("add", {
                user: h().user,
                comment: t
            }),
            C.refresh()
        }
        function r(i) {
            var a = arguments[3];
            d !== a && (g.hide(),
            m = l({
                brief_id: d = a
            }),
            m.done(s).fail(function(n) {
                t.modal(),
                e.alert("ERROR", n)
            }),
            n(".addwork-link", o).attr("href", e.addwork_link(d)),
            v.addCommentForm(null, d))
        }
        function s(e) {
            o.find(".brief-city-name").html(e.location && e.location.city),
            g.fadeIn(400),
            f = e,
            k.agreeVote(e).on("vote:vote", c),
            _.briefModalContent(e),
            b.briefCommentsList(e.comments),
            v.not(":first-of-type").toggle(e.comments && e.comments.length >= 5),
            v.find("textarea").attr("placeholder", n.fn.localization.getText("brief.comment.placeholder")),
            n(i.documentElement).trigger("resize:after"),
            C.refresh(),
            C.scrollTo(0)
        }
        function c(t, n) {
            if (f && "boolean" != typeof f.voted && !p) {
                if (!e.user.isAuthorized())
                    return void e.user.auth();
                if ("boolean" == typeof n) {
                    p = !0;
                    var i = n ? "agree" : "disagree";
                    u({
                        brief_id: d,
                        agree: i
                    }).done(function(e) {
                        f[i] = e[i] || 1 + ~~(f[i] || 0),
                        f.voted = i,
                        k.agreeVote(f)
                    }).fail(function(t) {
                        e.alert(t)
                    }).always(function() {
                        p = !1
                    })
                }
            }
        }
        var l, u, d, h, f, p, m, g = o.children();
        o.on("modal-item:change", r);
        var v = o.find(".add-comment-form").on("add-comment-form:add", a)
          , _ = o.find(".brief-modal__cont").briefModalContent()
          , b = o.find(".brief-comments-list").briefCommentsList()
          , k = o.find(".agree-vote")
          , w = n(".show-graphics")
          , y = w.find("a")
          , x = o.find(".scroll__masked")
          , C = x.scrollbarCustom().data("scrollCustom");
        x.on("scroll:scrolled", function(e) {
            w.removeClass("scroll-visible")
        }),
        x.on("scroll:top", function(e) {
            w.addClass("scroll-visible")
        }),
        n(i.documentElement).on("resize:after", function() {
            if (C.refresh(),
            w.css("right", n(".k-menu__authorization").outerWidth()),
            t.checkMobile.css.isMobile() || i.body.clientWidth < 1025) {
                var e = o.find(".brief-city-name--mobile");
                i.body.clientWidth - 2 * e.offset().left < w.outerWidth() + e.outerWidth() ? o.addClass("show-graphics--position-down") : o.removeClass("show-graphics--position-down")
            }
        }),
        o.on("modal-item:show  modal-item:hide", function(e) {
            m.always(function() {
                C.refresh(),
                o.find(".scroll").trigger(e.type.replace("modal-item", "scroll")),
                f.works_count > 0 && "modal-item:show" === e.type ? (y.attr("href", "brief.html?brief_id=" + d),
                w.addClass("visible")) : (y.attr("href", "#"),
                w.removeClass("visible"))
            })
        });
        var M = null;
        o.on("modal-item:show", function() {
            m.always(function() {
                M || (M = e.get_metadata(),
                n("title").html(f.title),
                n('meta[property="og:title"]').attr("content", f.title),
                n('meta[property="og:description"]').attr("content", f.stripped_body),
                n('meta[property="og:image"]').attr("content", f.image_share),
                n('meta[property="og:url"]').attr("content", f.share_url),
                n('meta[name="description"]').attr("content", f.stripped_body))
            })
        }),
        o.on("modal-item:hide", function() {
            m.always(function() {
                M && (e.set_metadata(M),
                M = null)
            })
        }),
        o.on("scroll:do_refresh", function() {
            C.refresh()
        }),
        this.init = function(e, t, n, i) {
            i && (h = i),
            e && (l = e),
            n && (u = n),
            t && v.addCommentForm(t)
        }
    }
    n.fn.briefModal = t.jQueryConstructor("BriefModal", a)
}(app = app || {}, peppers = peppers || {}, jQuery, document, Handlebars);
var app, peppers;
!function(e, t, n, i, o) {
    function a(a) {
        function r(t) {
            return t = t.list || [],
            t.forEach(function(t, n, i) {
                t.currentPage = n + 1,
                t.totalPages = i.length,
                t.carousel = i.length > 1;
                var o = (n - 1 + i.length) % i.length
                  , a = (n + 1) % i.length;
                t.prev_id = i[o].id,
                t.next_id = i[a].id,
                t.link = e.user_link(t.author.id),
                t.type = "sphere"
            }),
            t
        }
        function s() {
            if (!e.user.isAuthorized())
                return void e.user.auth();
            var t = _ || v[0] || v;
            t && t.id && p({
                work_id: t.id
            }).done(function() {
                a.find(".brief-user__likes-value").html(o.helpers.formatNumber(++t.likes))
            }).fail(function(t) {
                e.alert(t)
            })
        }
        function c(e) {
            if (v = e,
            0 == v.length)
                return n.hash = "/modal/brief/" + b.brief_id,
                void t(i.documentElement).on("modal:close", function(e) {
                    e.preventDefault(),
                    window.historyBack()
                });
            t(window).on("hashchange", u),
            u() || d(0)
        }
        function l(e) {
            var n = t(".timeline")
              , i = n.data("$timeline");
            if (i) {
                var o = v[e].brief
                  , a = v[e].author
                  , r = o && o.attached ? o.attached : []
                  , s = a && a.id ? a.id : null;
                i.initLinks(r, s)
            } else
                n.one("timeline:init", function() {
                    l(e)
                })
        }
        function u(e) {
            var t = /^#\/(\d+)$/.exec(n.hash);
            if (t)
                for (var i = 0; i < v.length; i++)
                    if (v[i].id == t[1])
                        return d(i),
                        !0
        }
        function d(n) {
            var i = v[n].brief;
            if (_ = v[n],
            e.DATA = e.DATA || {},
            e.DATA.work_id != v[n].id) {
                e.DATA.work_id = v[n].id,
                k.briefUser(v[n], n, v.length);
                var o = i && i.type || v[n].brief_type || "panorama"
                  , r = i && i.location && i.location.city
                  , s = a.find(".brief-city-name").html(r);
                s.width(),
                parseFloat(t("html").css("fontSize"));
                a.toggleClass("brief-360_long-name", r.length > 18),
                a.removeClass("brief-360_panorama  brief-360_thing").addClass("brief-360_" + o);
                var c = v[n];
                switch (c.brief && (t("title").html(c.brief.title),
                t('meta[property="og:title"]').attr("content", c.brief.title),
                t('meta[property="og:description"]').attr("content", c.brief.stripped_body),
                t('meta[property="og:image"]').attr("content", c.brief.image_share),
                t('meta[name="description"]').attr("content", c.brief.stripped_body)),
                t('meta[property="og:url"]').attr("content", c.share_url),
                o) {
                case "panorama":
                    w.briefPanorama(v[n], m, b.brief_id);
                    break;
                case "thing":
                    h(),
                    w.css({
                        backgroundImage: "url('" + v[n].image + "')"
                    })
                }
                l(n)
            }
        }
        function h() {
            g || (g = !0,
            m({
                brief_id: b.brief_id
            }).done(f))
        }
        function f(e) {
            a.find(".green-hex__title").html(e.name),
            a.find(".green-hex__body").html(e.body)
        }
        var p, m, g, v, _, b = e.parseURL(!0), k = t(".brief-user", a), w = t(".brief__panorama", a);
        t(".brief__brief-link", a).attr("href", e.brief_link(b.brief_id, 0)),
        t(".brief__addwork", a).attr("href", e.addwork_link(b.brief_id)),
        a.on("brief-user:like", s),
        this.init = function(t, n, i) {
            p = n,
            m = i,
            t({
                brief_id: b.brief_id
            }, r).done(c).fail(function() {
                e.navigateTo("404.html")
            })
        }
    }
    function r(e) {
        var t = o.compile(e.attr("href"));
        this.init = function(n) {
            e.toggle(n.carousel),
            e.attr("href", t(n))
        }
    }
    function s(e) {
        function n(t) {
            t.preventDefault(),
            e.trigger("brief-user:like")
        }
        var a, s = e.find("[type='text/x-handlebars-template']"), c = o.compile(s.html()), u = new r(t(".brief-360__arrow_prev")), d = new r(t(".brief-360__arrow_next")), h = t(i.documentElement);
        this.init = function(i) {
            function o() {
                a.find(".skew").css("visibility", "").stop().filter(":visible").css({
                    width: "",
                    minWidth: ""
                }).each(function() {
                    var e = t(this)
                      , n = e.children().outerWidth();
                    e.data("width", n)
                }).css({
                    width: 0,
                    minWidth: "inherit"
                }).each(function(e) {
                    var n = t(this).delay(1e3 + 200 * e).animate({
                        width: t(this).data("width")
                    }, 500);
                    n.is(".brief-user__index") || n.find(".skew__text").css("margin-left", "-11rem")
                })
            }
            h.off("resize:after", o),
            a && a.remove(),
            a = t(c(i)).insertAfter(s),
            u.init(i),
            d.init(i),
            t(".user-data__userpic", e).css("backgroundImage", "url('" + i.author.image + "')"),
            a.find(".brief-user__like-btn").click(n),
            a.find(".skew").css("visibility", "hidden"),
            l.done(function() {
                t(".user-pic", e).addClass("user-pic--visible"),
                h.data("size") ? o() : h.one("resize:after", o),
                setTimeout(function() {
                    t(".brief-user__arrow", e).addClass("brief-user__arrow_visible")
                }, 1600)
            })
        }
    }
    function c(e) {
        function n(t, n, i) {
            s || (s = new PNRM.GUI,
            r = window.panoramaViewer = new PNRM.Player(e,s));
            var o = t.points;
            if (o) {
                if ("string" == typeof o) {
                    o = t.points = JSON.parse(o);
                    for (var a = 0; a < o.length; a++) {
                        var h = o[a]
                          , f = h.data.split(";");
                        h.x = parseFloat(f[0]),
                        h.y = parseFloat(f[1]),
                        h.z = parseFloat(f[2]),
                        h.name = h.brief_name,
                        h.link = h.brief_id == i ? "#/modal/brief/" + i : function(e) {
                            return function() {
                                return n({
                                    brief_id: e.brief_id
                                })
                            }
                        }(h)
                    }
                }
            } else
                t.points = [];
            l.finish().fadeIn(100),
            u.finish().fadeOut(100),
            r.createPanorama(t, function() {
                l.finish().fadeOut(100),
                d || u.finish().fadeIn(100)
            }),
            c = r.VR
        }
        function i(e) {
            c.enableVR(e),
            r.fullscreenToggle(e),
            u.finish().hide()
        }
        function o() {
            Util.addEvent("up", h, a),
            Util.addEvent("move", h, function() {
                u.finish().fadeOut(),
                Util.removeEvent("down", h, o),
                a(),
                d = !0
            })
        }
        function a() {
            Util.removeEvent("up", h, a),
            Util.removeEvent("move", h)
        }
        var r, s, c, l = t(".transition__preloader", e);
        this.init = function(e, t, i) {
            n(e, t, i)
        }
        ,
        t(".to-vr").click(function() {
            i(!0)
        });
        var u = t(".tooltip-360", e);
        u.hide();
        var d = !1
          , h = t(window);
        Util.addEvent("down", h, o)
    }
    var l = function() {
        var e = t.Deferred();
        return t(i).on("fade:complete", function() {
            e.resolve()
        }),
        e.promise()
    }();
    t.fn.brief = peppers.jQueryConstructor("brief", a),
    t.fn.briefUser = function(e) {
        this.each(function() {
            var n = t(this)
              , i = n.data("BriefUser");
            i || n.data("BriefUser", i = new s(n)),
            i.init(e)
        })
    }
    ,
    t.fn.briefPanorama = peppers.jQueryConstructor("briefPanorama", c)
}(app = app || {}, jQuery, window.location, document, Handlebars);
var app;
!function(e, t, n) {
    function i(i) {
        function o(o) {
            function a(t) {
                var n = t && t.briefs;
                if (!n || !n.length)
                    return void (C = !0);
                M && _.find(".list__item").off().remove().localization("destroy"),
                e(w(n)).filter(".list__item").each(function(t) {
                    e(this).toggleClass("animated", t < k + 3).css("animationDelay", .05 * t + "s")
                }).appendTo(_).each(r).localization("en"),
                i.trigger("predictions:update", M)
            }
            function r(t) {
                e(this).css({
                    animationDelay: .3 + .04 * t + "s"
                })
            }
            function s(e) {
                b++;
                _.find(".list__item").each(function(e) {});
                i.trigger("predictions:update", !1)
            }
            function c(t) {
                var n = arguments.length > 0 && "string" == typeof t;
                if (n) {
                    if (t.length && t.length < 3)
                        return void app.alert(e.fn.localization.getText("search.short_request_string"));
                    if (0 === t.length && (t = ""),
                    z == t)
                        return;
                    z = t,
                    M = !0
                } else
                    M = !1;
                if (!x) {
                    var i = x = y({
                        filter: "brief",
                        search: z || ""
                    }, l).done(a).always(function() {
                        x === i && (x = void 0),
                        n && z != t && c(z)
                    });
                    return i
                }
            }
            function l(e) {
                return e.briefs.forEach(function(e) {
                    e.link = app.brief_link(e.id, e.works_count || e.works)
                }),
                e
            }
            var u = Expo.easeOut
              , d = i.find("hr").width(0).get(0)
              , h = i.find(".search__submit").css({
                opacity: 0,
                right: 100 * (1 - u.getRatio(.3)) + "%"
            }).get(0)
              , f = i.find(".search__reset").css({
                opacity: 0,
                right: 100 * (1 - u.getRatio(.3)) + "%"
            }).get(0)
              , p = i.find(".pep-placeholder__text");
            0 == p.length && (E.pepPlaceholder(function(e) {
                var t = "</span>";
                return "<span>" + e.split("").join(t + "<span>") + t
            }),
            p = i.find(".pep-placeholder__text"));
            var m = p.children().css({
                opacity: 0
            });
            n.to(d, 1.5, {
                width: "100%",
                delay: .8,
                ease: u
            }),
            n.to(h, 1.05, {
                right: 0,
                opacity: 1,
                delay: 1.25,
                ease: Power3.easeOut
            }),
            n.to(f, 1.05, {
                right: 30,
                opacity: 1,
                delay: 1.25,
                ease: Power3.easeOut
            });
            var g = peppers.hash.getHash();
            "search" === g[1] && "text" === g[2] && g[3] || m.each(function(e) {
                n.to(this, .75, {
                    opacity: 1,
                    delay: .8 + .1 * e,
                    ease: RoughEase.ease.config({
                        template: Power0.easeNone,
                        strength: 2,
                        points: 10,
                        taper: "none",
                        randomize: !0,
                        clamp: !0
                    })
                })
            });
            var v = e('[type="text/x-handlebars-template"]', i)
              , _ = v.parent()
              , b = (i.find(".load-more").click(s),
            1)
              , k = 9
              , w = t.compile(v.html());
            i.on("scroll:bottom", s);
            var y, x, C, M, z = "";
            D || (D = !0,
            i.on("click", "a", function(t) {
                if ("#" === e(this).attr("href").substr(0, 1)) {
                    var n = location.hash;
                    peppers.modal(),
                    e(document.documentElement).one("modal:hide", function() {
                        location.hash = n
                    })
                }
            })),
            e(function() {
                function t() {
                    a = e(this).val(),
                    clearTimeout(r),
                    r = setTimeout(o, 300)
                }
                function n(e) {
                    e.preventDefault(),
                    o()
                }
                function o() {
                    clearTimeout(r),
                    c(a)
                }
                var a, r;
                i.find(".predictions__search").each(function() {
                    e(this).on("submit", n),
                    e(this).find("input").on("change  keyup", t)
                })
            }),
            this.init = function(e) {
                e && (y = e,
                c())
            }
        }
        function a(e) {
            E.val("").trigger("input:empty"),
            l(),
            c(e)
        }
        function r(e) {
            e.preventDefault(),
            u()
        }
        function s(e) {
            e.preventDefault(),
            u(!0)
        }
        function c(t) {
            w = "",
            e(".tags_line").addClass("hidden"),
            e(".tag_search").html(""),
            f();
            var n = peppers.hash.getHash();
            "modal" == n[0] && "search" == n[1] && peppers.hash.setHash("/modal/search")
        }
        function l(e) {
            clearTimeout(k);
            var t = v();
            if (t.length > 2 && !b && "function" == typeof _)
                k = setTimeout(u, 300);
            else {
                t.length < 3 && (w = ""),
                z.removeClass("search__result_visible");
                var n = peppers.hash.getHash();
                "modal" == n[0] && "search" == n[1] && peppers.hash.setHash("/modal/search")
            }
        }
        function u(t) {
            if (peppers.checkMobile.css.isMobile() && e("body, html").animate({
                scrollTop: 0
            }, 300),
            x && x.remove(),
            j.scrollTo(0, 0, 0),
            clearTimeout(k),
            !b && "function" == typeof _)
                try {
                    var n, i;
                    if (b)
                        return;
                    var o = new RegExp("([\\" + "\\/.+*?|^[]{}()".split("").join("\\") + "])","g")
                      , a = {};
                    if (t) {
                        a.filter = "by/tag",
                        i = "tagsearch",
                        n = e(".tag_search").text();
                        var r = n;
                        n.toUpperCase().startsWith("КОНКУРС") && (n = "конкурс",
                        r = "competition"),
                        peppers.hash.setHash("/modal/search/tag/" + r)
                    } else
                        e(".tags_line").addClass("hidden"),
                        e(".tag_search").html(""),
                        i = "search",
                        n = v(),
                        peppers.hash.setHash("/modal/search/text/" + n);
                    if (n.length < 3 && !0 !== t)
                        return void app.alert(e.fn.localization.getText("search.short_request_string"));
                    a[E.attr("name")] = w = n,
                    b = _(a),
                    y = new RegExp("(" + w.replace(/^\s+|\s+$/g, "").toLowerCase().replace(o, "\\$1") + ")","ig"),
                    b.always(function() {
                        p(),
                        h()
                    }).done(function(e) {
                        m(e, i)
                    }),
                    d()
                } catch (e) {
                    w = "",
                    b = void 0
                }
        }
        function d() {
            e(".transition-wrapper").removeClass("transition-wrapper_fade-out")
        }
        function h() {
            e(".transition-wrapper").addClass("transition-wrapper_fade-out")
        }
        function f() {
            e(".modal__ui.search .tags").removeClass("hidden"),
            e(".modal__ui.search .predictions-result").addClass("hidden"),
            x && x.remove(),
            z.removeClass("search__result_visible")
        }
        function p() {
            b = void 0
        }
        function m(t, n) {
            "tagsearch" == n && e(".tags_line").removeClass("hidden");
            var i = e.fn.localization.getText("predictions.title");
            t.briefs.length > 0 && (i += "&nbsp;(" + t.briefs.length + ")"),
            e("#predictions_title").html(i);
            var o = e.fn.localization.getText("futurologists.title");
            t.authors.length > 0 && (o += "&nbsp;(" + t.authors.length + ")"),
            e("#futurologists_title").html(o);
            var a, r;
            e(".modal__ui.search .tags").addClass("hidden");
            var s = e(".modal__ui.search .predictions-result").removeClass("hidden");
            if (x && x.remove(),
            z.addClass("search__result_visible"),
            t.users) {
                var c = [];
                for (a = 0; a < t.users.length; a++) {
                    var l, u = t.users[a];
                    for (r = 0; r < u.works.length; r++)
                        c.push(l = u.works[r]),
                        l.author = u.name
                }
                c.length > 0 && (t.works = c)
            }
            var d = ["authors", "briefs", "users", "works"]
              , h = x = e('<div class="column  predictions__column  checkbox-nth-item  listpredictions"></div><div class="column  predictions__column  checkbox-nth-item  futurologists"></div>');
            for (h.appendTo(M),
            a = 0; a < d.length; a++) {
                var f = d[a];
                if (t.hasOwnProperty(f) && t[f].length > 0) {
                    t[f].map(function(e) {
                        if ("tagsearch" == n)
                            return e.tagsearch = !0
                    });
                    var p = e(T({
                        title: f,
                        list: t[f].map(g)
                    }));
                    switch (p.localization("en"),
                    f) {
                    case "authors":
                        p.appendTo(h.eq(1));
                        break;
                    default:
                        p.appendTo(h.eq(0))
                    }
                }
            }
            h.each(function() {
                if (!e(this).find(".search__result-list").length) {
                    var t = e(T({
                        title: "empty_column_placeholder",
                        list: [{
                            text: "Oops! We found nothing."
                        }]
                    }));
                    t.appendTo(e(this)),
                    t.localization("en")
                }
            }),
            h.find(".search__result-column").each(function() {
                function t() {
                    var t = n * i
                      , o = !1;
                    a.each(function(n) {
                        var i = n >= t;
                        e(this).toggleClass("__desktop", i),
                        e(this).toggleClass("__visible", !i),
                        o = o || i
                    }),
                    r.toggle(o)
                }
                var n = 1
                  , i = 8
                  , o = e(this)
                  , a = o.find(".search__result-item")
                  , r = o.find(".load-more");
                r.click(function() {
                    n++,
                    t()
                }),
                t()
            });
            var m = s.find(".checkbox-nth:checked");
            m.length > 0 && (m = s.find(".checkbox-nth").eq(0).prop("checked", !0)),
            s.find("label[for=" + m.attr("id") + "]").click(),
            m.change(),
            requestAnimationFrame(function() {
                j.refresh()
            })
        }
        function g(e) {
            if ("object" == typeof e && e.$highlited)
                return e;
            switch (typeof e) {
            case "undefined":
                break;
            case "boolean":
            case "number":
            case "string":
                return ("" + e).replace(y, '<span class="search__target">$1</span>');
            case "object":
                for (var t in e)
                    "$highlited" != t && e.hasOwnProperty(t) && !/^images?|previews?$/.test(t) && e[t] && (e[t] = g(e[t]));
                e && (e.$highlited = !0)
            }
            return e
        }
        function v() {
            return E.val()
        }
        var _, b, k, w, y, x, C = i.find('[type="text/x-handlebars-template"]'), M = C.parent(), z = i.find(".search__result"), T = t.compile(C.html()), D = !1, E = i.find(".search__input");
        i.find("form").on("submit", r),
        i.find("form").on("search:tag", s),
        i.find("form").on("reset", c),
        i.on("modal-item:show", o),
        i.on("modal-item:hide", a);
        var j = i.find(".scroll__masked").scrollbarCustom().data("scrollCustom");
        this.initAPI = function(e) {
            _ = e
        }
        ,
        e(document.documentElement).on("resize:after", j.refresh),
        i.on("modal-item:show  modal-item:hide", function(e) {
            i.find(".scroll").trigger(e.type.replace("modal-item", "scroll"))
        });
        var O = e(".modal__ui.search .tags");
        i.on("modal-item:show", function() {
            e(".tags__item_text").each(function() {
                var t = e(this);
                t.css("font-size", "15px");
                var n = t.outerWidth()
                  , i = t.parents(".tags__item").outerWidth()
                  , o = .8 * i;
                if (n >= o)
                    do {
                        var a = parseInt(t.css("font-size")) - 1;
                        t.css("font-size", a + "px"),
                        n = t.outerWidth()
                    } while (n >= o)
            }),
            setTimeout(function() {
                O.addClass("animationFlashing"),
                setTimeout(function() {
                    O.removeClass("animationFlashing")
                }, 4e3)
            }, 3e3)
        }),
        i.on("modal-item:hide", function() {
            O.hasClass("animationFlashing") && O.removeClass("animationFlashing")
        }),
        e(".modal__ui.search").on("click", ".tags .tags__item, .search__brief-tag-text", function(t) {
            t.preventDefault(),
            t.stopPropagation(),
            e(".search__form .search__input").trigger("reset");
            var n = e(this).find(".tags__item_text").text() || e(this).text();
            return "КОНКУРС" === n.toUpperCase() && (n = 'конкурс &nbsp(<a class="contest_link" target="_blank" href=\'https://www.app.ru/blog/earth-2050-contest/20089/\'>победители</a>)'),
            e(".tag_search").html(n),
            e(".modal__ui.search .search__form").trigger("search:tag"),
            !1
        })
    }
    e.fn.search = function(t) {
        this.each(function() {
            var n = e(this)
              , o = n.data("search");
            o || n.data("search", o = new i(n)),
            o.initAPI(t)
        })
    }
}(jQuery, Handlebars, TweenLite),
function(e, t, n) {
    function i(t) {
        function i(e) {
            t.removeClass("login_login login_sign-up login_restore login_change-password").addClass("login_" + (arguments[3] || "login").replace(/_/g, "-"))
        }
        function o() {
            t.find(".login__content").blink()
        }
        function a() {}
        var r = {};
        t.on("modal-item:change", i).on("modal-item:show", o).on("modal-item:hide", a),
        function(i) {
            function o(t) {
                t.preventDefault(),
                d || s(t, r.login.social(e(this).data("soc-type")))
            }
            function a(t) {
                t.preventDefault();
                var n = e(this).attr("action") || "login";
                d || s(t, r[n](e(this).serialize()))
            }
            function s(e, t) {
                e.preventDefault(),
                d = !0,
                t.done(l).fail(c).always(u)
            }
            function c(e) {
                n.alert(e)
            }
            function l() {
                t.trigger("modal:hide")
            }
            function u() {
                setTimeout(function() {
                    d = !1
                }, 400)
            }
            var d = !1;
            i.on("form:submit", a),
            i.filter(":not(.form_validate)").on("submit", a),
            e(".login__social-button", i).click(o)
        }(t.find(".login__form")),
        this.init = function(e, t, n, i) {
            r.login = e || r.login,
            r.register = t || r.register,
            r.restore = n || r.restore,
            r["change-password"] = i || r["change-password"]
        }
    }
    e.fn.loginModal = function(t, n, o, a) {
        this.each(function() {
            var r = e(this)
              , s = r.data("loginModal");
            s || r.data("loginModal", s = new i(r)),
            s.init(t, n, o, a)
        })
    }
}(jQuery, TweenLite, app = app || {});
var app;
!function(e, t, n, o, a, r, s, c) {
    function l(t) {
        for (var n in t)
            t.hasOwnProperty(n) && /^\d+$/.test(n) && t[n].briefs.sort(function(e, t) {
                return t.votes - e.votes
            }).forEach(function(t) {
                t.link = e.brief_link(t),
                t.names = [{
                    list: e.trimText(t.name, 18, 3),
                    type: "desktop"
                }, {
                    list: e.trimText(t.name, 10, 5),
                    type: "mobile"
                }]
            });
        return t
    }
    function u(e, t, n) {
        function i(e) {
            o("mouseenter" == e.type, !0)
        }
        function o(t, n) {
            function i(e, t, n, i) {
                (t ? e.find("." + n) : e).toggleClass(n + "_visible", i)
            }
            var o = new r.Event("visible:toggle");
            if (o.data = {
                visible: t,
                mouse: !!n
            },
            l.dispatchEvent(o),
            c !== t) {
                c = t;
                var d = e;
                i(d, !1, u + "point", t),
                i(d, !0, u + "concept-info", t),
                i(d, !0, "concept-name__line", t),
                clearTimeout(s),
                s = setTimeout(function() {
                    a = t
                }, t ? 300 : 0)
            }
        }
        var a, s, c, l = this, u = "hexagonal-map__";
        this.jQueryElement = e,
        this.initVisible = o,
        this.DOMElement_constructor(e.get(0)),
        this.x = t.x,
        this.y = t.y,
        t.x > .5 * n && e.find(".concept-name").addClass("concept-name_right"),
        e.on("click", function(e) {
            if (!a)
                return e.preventDefault(),
                !1
        }),
        e.on("mouseenter  mouseleave", i),
        this.mapPoint = e.find(".hexagonal-map__point").css({
            transform: "scale(0)"
        })
    }
    function d(e) {
        function n(e) {
            t.load(e).done(function(e) {
                u.resolve({
                    image: e.get(0),
                    info: {
                        imgWidth: r,
                        imgHeight: s,
                        width: o,
                        height: o,
                        dx: -i,
                        dy: -i
                    }
                }),
                e.remove()
            }).fail(function() {
                var t = "images/hex.svg";
                e != t && n(t)
            })
        }
        var i = 4
          , o = 2 * i
          , r = o + 1
          , s = o + 1
          , c = {
            alpha: 1,
            color: "#31B987",
            points: "2.5,8.5 0.5,4.5 2.5,0.5 6.5,0.5 8.5,4.5 6.5,8.5"
        };
        c = a.extend(c, e);
        var l = '<svg x="0px" y="0px" width="9" height="9"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><polygon vector-effect="non-scaling-stroke" style="opacity:{{alpha}};fill:{{color}};" points="{{points}}"/><polygon vector-effect="non-scaling-stroke" style="fill:none;stroke:{{color}};stroke-miterlimit:10;" points="{{points}}"/></svg>';
        l = l.replace(/\{{2}([_\w\d]+)\}{2}/g, function(e, t) {
            return c[t]
        });
        var u = a.Deferred();
        return n("data:image/svg+xml;utf8," + encodeURIComponent(l)),
        u.promise()
    }
    function h(e) {
        this.canvases = [];
        for (var t = 0; t < e; t++) {
            var n = o.createElement("canvas");
            n.context = n.getContext("2d"),
            this.canvases.push(n)
        }
    }
    function f(e, t, n, i) {
        var o = 4 * (Math.floor(n) * i + Math.floor(t));
        return e.slice(o, o + 4)
    }
    function p(e) {
        for (var t = e[0].clone(), n = e[0].clone(), i = 0; i < e.length; i++)
            t.x = Math.min(t.x, e[i].x),
            t.y = Math.min(t.y, e[i].y),
            n.x = Math.max(n.x, e[i].x),
            n.y = Math.max(n.y, e[i].y);
        return {
            x: t.x,
            y: t.y,
            width: n.x - t.x,
            height: n.y - t.y,
            left: t.x,
            top: t.y,
            bottom: n.y,
            right: n.x
        }
    }
    var m, g = (Math.sqrt(3),
    .5);
    a.fn.hexagonalMap = function(t) {
        var n;
        this.each(function() {
            m || (m = a.when(d({
                alpha: .4
            })));
            var i = a(this)
              , o = i.data("hexagonal-map");
            o || i.data("hexagonal-map", o = new e.HexagonalMap(i,i.find(".hexagonal-map__canvas-map").get(0),i.find(".hexagonal-map__canvas-shadow").get(0),{
                size: 8,
                offset: 0,
                border: 0
            }));
            var r = e.parseURL(!0);
            o.init(n = n || t({
                location_id: r.location_id
            }, l))
        })
    }
    ;
    var v = r.extend(u, r.DOMElement);
    v.show = function(e) {
        s.to(this.mapPoint.get(0), .4, {
            transform: "scale(1)",
            delay: e || 0,
            ease: Back.easeOut
        })
    }
    ,
    v.hide = function(e) {
        var t = this;
        this.jQueryElement.off(),
        s.to(this.mapPoint.get(0), .4, {
            transform: "scale(0)",
            delay: e || 0,
            ease: Sine.easeIn,
            onComplete: function() {
                t.jQueryElement.remove(),
                delete t.mapPoint,
                delete t.jQueryElement
            }
        })
    }
    ,
    v.scale = function(e) {
        this.scaleX = this.scaleY = e,
        this.htmlElement && this._handleDrawEnd()
    }
    ,
    v._handleDrawEnd = function() {
        this.DOMElement__handleDrawEnd();
        var e = this.htmlElement;
        if (e) {
            var t = e.style;
            t.transform = t.transform.replace(/px/g, "")
        }
    }
    ,
    r.promote(u, "DOMElement"),
    e.HexagonalMap = function(n, c, l, d) {
        function v() {
            n.find(".hexagonal-map__container").css({
                transform: "scale(" + R.scale + ")",
                width: R.width * R.scale,
                height: R.height * R.scale
            });
            for (var e = 1 / R.scale, t = 0; t < q.length; t++)
                q[t].scale(e)
        }
        function _(e, t) {
            j = t,
            w()
        }
        function b(e) {
            P.find(".city-name__city").html(e.location && e.location.city || "CITY"),
            P.find(".city-name__country").html(e.location && e.location.country || "COUNTRY"),
            E = e,
            w()
        }
        function k() {
            for (var e = a.Deferred(); q.length; ) {
                var t = q.pop();
                L.removeChild(t),
                t.hide()
            }
            if (O && (O.destroy(),
            O = void 0),
            L.children.length > 0) {
                D([e.promise()]);
                for (var n = 0; n < L.children.length; n++)
                    !function(t, n) {
                        s.to(t, .25, {
                            alpha: 0,
                            delay: .2 + .1 * n,
                            ease: Sine.easeOut,
                            onComplete: function() {
                                L.removeChild(t),
                                0 === L.children.length && e.resolve()
                            }
                        })
                    }(L.children[n], n)
            } else
                e.resolve();
            return e.promise()
        }
        function w() {
            E && j && a.when(m, t.load(E[j].url), k()).done(y).fail(function(e) {})
        }
        function y(e, n) {
            function i() {
                T(f);
                for (var e = E[j].briefs, t = 0; t < e.length; t++) {
                    var n = e[t]
                      , i = a(I(n))
                      , o = i.find(".map-point")
                      , r = !1;
                    if (n.image && n.image.url) {
                        var s = "string" == typeof n.image.url ? n.image.url : n.image.url.first;
                        s && !/no (image|preview)/i.test(s) || (r = !0)
                    } else
                        r = !0;
                    o.toggleClass("map-point_" + n.type, !!n.type).toggleClass("map-point_no-image", r).toggleClass("map-point_no-works", !(n.works_count > 0)),
                    i.find(".hexagonal-map__concept-info").toggleClass("hexagonal-map__concept-info_no-image", r),
                    Q.append(i);
                    var d = new u(i,l.points[h[t]],c.width);
                    L.addChild(d),
                    q.push(d),
                    d.addEventListener("visible:toggle", function(e) {
                        e.data.mouse && O.toggle(!e.data.visible)
                    })
                }
                O && O.destroy(),
                O = new x(q).start(),
                v()
            }
            var r = e
              , s = t.getImageData(n, {
                width: 525
            })
              , l = C(s, r.info);
            n.remove();
            var h = M(l.points, l.centerPointIndex, E[j].briefs.length)
              , f = p(l.points);
            f.width += r.info.imgWidth,
            f.height += r.info.imgHeight,
            $.clear(),
            $.size(f.width, f.height);
            for (var m = 0; m < l.points.length; m++) {
                var g = r;
                !function(e, t, n, i) {
                    e.context.drawImage(n, d.border + t.dx + i.x, d.border + t.dy + i.y, t.imgWidth, t.imgHeight)
                }($.random(), g.info, g.image, l.points[m])
            }
            S ? (a(o).one("fade:complete", i),
            S.resolve(),
            S = void 0) : i()
        }
        function x(e) {
            function t() {
                a && 0 != a.length || (a = n(e)),
                r && r.initVisible(!1),
                (r = a.pop()) && r.initVisible(!0)
            }
            function n(e) {
                for (var t = [].concat(e), n = t.length; n > 0; n--) {
                    var i = Math.random() * n;
                    t.push(t.splice(~~i, 1)[0])
                }
                return t
            }
            var i, o, a, r, s = this;
            this.destroy = function() {
                this.stop(),
                i = 3
            }
            ,
            this.toggle = function(e) {
                e ? this.start() : this.stop()
            }
            ,
            this.start = function() {
                if (1 != i && 3 != i)
                    return o = setInterval(t, 5e3),
                    t(),
                    s
            }
            ,
            this.stop = function() {
                if (2 != i && 3 != i)
                    return r && r.initVisible(!1),
                    r = void 0,
                    clearInterval(o),
                    s
            }
        }
        function C(e, n) {
            for (var i, o = e.data, a = e.width, r = e.height, s = -n.dx, c = -n.dy, l = Math.ceil(1.5 * n.width + d.offset), u = Math.ceil(n.height / 2 + d.offset), h = [], p = new t.Point(.5 * a,.5 * r), m = 999999, v = 0, _ = c; _ < r; _ += u,
            v++)
                for (var b = 0, k = s + (1 & v) * l * .5; k < a; k += l,
                b++)
                    if (f(o, k, _, a)[3] >= g) {
                        var w = new t.Point(k,_);
                        w.index = {
                            h: b,
                            v: v
                        };
                        var y = w.distance(p);
                        (y < m || !i) && (m = y,
                        i = h.length),
                        h.push(w)
                    }
            return {
                points: h,
                centerPointIndex: i
            }
        }
        function M(e, t, n) {
            function o(e, t) {
                for (var n = [], i = t.length - 1; i >= 0; i--)
                    z(e, t[i]) && n.push(t.splice(i, 1)[0]);
                return n
            }
            for (var a = [].concat(e), r = [t], s = [0], c = a.splice(t, 1).pop(), l = [].concat(o(c, a)); a.length > 0 && r.length < n; ) {
                var u = Math.floor(Math.random() * a.length);
                c = a.splice(u, 1).pop(),
                a != l && l.push.apply(l, o(c, a));
                var d = c.distance(r[0]);
                for (i = 1; i < s.length && d > s[i]; )
                    i++;
                s.splice(i, 0, d),
                r.splice(i, 0, e.indexOf(c)),
                0 === a.length && (a = l)
            }
            return r
        }
        function z(e, t) {
            var n = Math.abs(e.index.v - t.index.v)
              , i = Math.abs(e.index.h - t.index.h);
            return 0 == i && n < 4 && n % 2 == 0 || n < 4 && n % 2 == 1 && (0 == i || e.index.h + (e.index.v % 2 * 2 - 1) == t.index.h) || 0 == n && i < 2
        }
        function T(e) {
            var t;
            l.width = c.width = e.width,
            l.height = c.height = e.height,
            R.width = parseFloat(c.width),
            R.height = parseFloat(c.height);
            for (var n = [], i = 0; i < $.canvases.length; i++) {
                t = new r.Bitmap($.canvases[i]),
                t.alpha = 0,
                L.addChild(t);
                var o = a.Deferred();
                s.to(t, .5, {
                    alpha: 1,
                    delay: .2 + .1 * i,
                    ease: Sine.easeOut,
                    onComplete: o.resolve
                }),
                n.push(o.promise())
            }
            D(n).then(function() {
                for (var e = Math.max(.08, Math.min(.2, 1 / q.length)), t = 0; t < q.length; t++)
                    q[t].show(.2 + t * e)
            })
        }
        function D(e) {
            function t() {
                i = !0
            }
            function n() {
                L.update(),
                A.cache(0, 0, c.width, c.height),
                H.update(),
                i && (r.Ticker.removeEventListener("tick", n),
                o.resolve())
            }
            var i, o = a.Deferred();
            return r.Ticker.addEventListener("tick", n),
            a.when.apply(null, e).then(t),
            n(),
            o.promise()
        }
        var E, j, O, S = e.ready.addWait(), P = n.closest(".content-app").find(".city-name"), I = Handlebars.compile(n.find('[type="text/x-handlebars-template"]').html()), L = new r.Stage(c), H = new r.Stage(l), $ = new h(5), A = function(e, t) {
            var n = new r.Bitmap(e);
            return t.addChild(n),
            n.alpha = .2,
            n.filters = [new r.ColorFilter(1,1,1,2.5), new r.BlurFilter(6,6,2)],
            n
        }(c, H), q = [], Q = n.find(".hexagonal-map__points-cont"), R = {};
        a(o.documentElement).on("resize:after", function() {
            R.scale = parseFloat(a(this).css("fontSize")) / 18,
            v()
        }),
        a(o).on("timeline:change", _),
        this.init = function(e) {
            e.done(b)
        }
    }
    ,
    h.prototype.size = function(e, t) {
        1 == arguments.length && (t = e);
        for (var n = 0; n < this.canvases.length; n++)
            this.canvases[n].width = e,
            this.canvases[n].height = t;
        return this
    }
    ,
    h.prototype.random = function() {
        var e = Math.random() * this.canvases.length;
        return this.canvases[Math.floor(e)]
    }
    ,
    h.prototype.join = function(e) {
        var t, n = this.canvases;
        t = "number" == typeof e ? n[e].context : e.getContext("2d");
        for (var i = 0; i < n.length; i++)
            i != e && t.drawImage(n[i], 0, 0, n[i].width, n[i].height);
        return n[e]
    }
    ,
    h.prototype.clear = function() {
        for (var e = 0; e < this.canvases.length; e++)
            this.canvases[e].context.clearRect(0, 0, this.canvases[e].width, this.canvases[e].height)
    }
}(app = app || {}, peppers = peppers || {}, window, document, jQuery, createjs, TweenLite, window.location);
var app, peppers;
!function(e, t, n, i, o) {
    function a(e) {
        return e.works.forEach(function(e) {
            e.link = app.brief_link(e.brief && e.brief.id || e.brief_id, 1, e.id),
            e.likes = e.likes || 0
        }),
        e.authors.forEach(function(e) {
            e.link = app.user_link(e.user && e.user.id || e.id),
            e.rating = e.rating || "-"
        }),
        e
    }
    function r(n) {
        function i(e, t, i) {
            var o = n.data("ratings-" + e);
            return o || n.data("ratings-works", o = new s(n.find(t))),
            o.init(e, i),
            o
        }
        var r, u, d = i("works", ".works", 0), h = i("authors", ".authors", 1), f = n.find(".scroll__masked").scrollbarCustom().data("scrollCustom");
        t(o.documentElement).on("resize:after", f.refresh),
        n.on("modal-item:show  modal-item:hide", function(e) {
            n.find(".scroll").trigger(e.type.replace("modal-item", "scroll")),
            f.refresh()
        }),
        n.on("modal-item:show", function() {
            u = u || r("", a),
            d.initData(u),
            h.initData(u),
            t.when(d.ready, h.ready).done(f.refresh)
        }),
        n.find(".checkbox-nth").on("change", function() {
            if (e.checkMobile.css.isMobile()) {
                var n = t(this).parent()
                  , i = n.find(".checkbox-nth")
                  , o = i.index(this)
                  , a = n.find(".checkbox-nth-item")
                  , r = a.eq(o);
                a.toggleClass("ratings__column_hide", !0),
                r.toggleClass("ratings__column_hide", !1)
            }
        }),
        n.find(".load-more").on("click", function(e) {
            e.preventDefault();
            var n = t(this).closest(".ratings__column");
            c(n),
            l(n),
            n.trigger("items:show"),
            f.refresh()
        }),
        n.find(".ratings__column").on("items:loaded", function() {
            var n = t(this);
            c(n),
            l(n),
            e.checkMobile.css.isMobile() && n.trigger("items:show")
        }),
        n.find(".ratings__column").on("items:show", function() {
            e.checkMobile.css.isMobile() && t(this).closest(".checkbox-nth-container").css("height", t(".ratings__column:not(.ratings__column_hide)").outerHeight() + "px")
        }),
        t(o.documentElement).on("resize:after", function() {
            e.checkMobile.css.isMobile() && t(".ratings__column").each(function() {
                t(this).closest(".checkbox-nth-container").css("height", t(".ratings__column:not(.ratings__column_hide)").outerHeight() + "px")
            })
        }),
        this.init = function(e) {
            e && (r = e)
        }
    }
    function s(e) {
        function i(e) {
            return function(n) {
                t(this).toggleClass("animated", n < 8).css({
                    animationDelay: .3 + .04 * (n + 2 * e) + "s"
                })
            }
        }
        var o, a, r = t(e), s = r.find("[type='text/x-handlebars-template']"), c = n.compile(s.html()), l = s.parent(), u = t.Deferred();
        this.ready = u.promise();
        var d, h;
        this.init = function(e, t) {
            d = e,
            h = t
        }
        ,
        this.initData = function(e) {
            o != e && (t(".transition-wrapper").removeClass("transition-wrapper_fade-out"),
            o = e,
            e.done(function(e) {
                t(".transition-wrapper").addClass("transition-wrapper_fade-out"),
                a && a.remove(),
                a = t(c(e[d])).filter(".list__item").appendTo(l).each(i(h)).localization("en"),
                t(l).trigger("items:loaded"),
                u.resolve()
            }).fail(function(e) {
                app.alert(e)
            }))
        }
    }
    function c(e, n) {
        var i = !!e == !!n
          , e = e || t(".ratings__column")
          , n = n || 8
          , o = e.find(".ratings__list-item_hide")
          , a = e.find(".ratings__list-item").not(".ratings__list-item_hide");
        i && a.length || o.length && o.slice(0, 8).removeClass("ratings__list-item_hide")
    }
    function l(e) {
        e = e || t(".ratings__column"),
        e.each(function() {
            var e = t(this).find(".load-more");
            t(this).find(".ratings__list-item_hide").length ? e.show().addClass("show") : e.hide().removeClass("show")
        })
    }
    t.fn.ratings = e.jQueryConstructor("ratings", r)
}(peppers = peppers || {}, jQuery, Handlebars, window, document);
var peppers;
!function(e, t, n, i, o, a) {
    function r(i) {
        function r(e) {
            var n = e && e.briefs
              , o = e && e.users;
            e.briefs.forEach(function(t, n) {
                if (t.works_count <= 1 && (e.briefs[n].works_count_1 = !0,
                e.briefs[n].works_count_2 = !1,
                e.briefs[n].works_count_3 = !1),
                2 == t.works_count && (e.briefs[n].works_count_1 = !1,
                e.briefs[n].works_count_2 = !0,
                e.briefs[n].works_count_3 = !1),
                t.works_count > 2 && (e.briefs[n].works_count_1 = !1,
                e.briefs[n].works_count_2 = !1,
                e.briefs[n].works_count_3 = !0),
                0 == t.works_count) {
                    var i = {
                        first: ""
                    };
                    i.first = "/frontend/images/default-preview.png",
                    e.briefs[n].image = i
                }
            });
            var a = t(k(n)).filter(".list__item");
            a.appendTo(v).each(s).localization("en");
            var r = t(w(o)).filter(".list__item");
            r.appendTo(_).each(s).localization("en"),
            a.length || t(y()).appendTo(v).localization("en"),
            r.length || t(y()).appendTo(_).localization("en"),
            [v, _].map(function(e) {
                e.closest(".load__column").trigger("items:loaded")
            }),
            i.find(".predictions__brief-tag").on("click", function() {
                var e = t(".modal__ui.search .search__form .search__input");
                e.val(t(this).find(".predictions__brief-tag-text").text()),
                e.trigger("change");
                var n = t(".modal__ui.search .search__form");
                n.find(".list").remove(),
                n.trigger("search:tag")
            }),
            b = 0,
            t(".transition-wrapper").addClass("transition-wrapper_fade-out")
        }
        function s(e) {
            var n = e % 8;
            t(this).css({
                animationDelay: .3 + .04 * n + "s"
            })
        }
        function l(e, n) {
            if (n = n || !1,
            e = e || "",
            arguments.length > 0 && "string" == typeof e) {
                if (e.length && e.length < 3)
                    return void app.alert(t.fn.localization.getText("search.short_request_string"));
                if (0 === e.length && (e = ""),
                h && !n)
                    return;
                t(".transition-wrapper").removeClass("transition-wrapper_fade-out"),
                x = e,
                f = !0
            } else
                f = !1,
                t(".transition-wrapper").removeClass("transition-wrapper_fade-out");
            f && (v.find(".list__item").off().remove().localization("destroy"),
            _.find(".list__item").off().remove().localization("destroy"),
            c());
            var i = h = d({
                filter: "brief",
                search: x || ""
            }, u).done(r).always(function() {
                t(".transition-wrapper").addClass("transition-wrapper_fade-out"),
                h === i && (h = void 0),
                x != e && l(x, !0)
            });
            return i
        }
        function u(e) {
            return e.briefs.forEach(function(e) {
                e.link = app.brief_link(e.id, e.works_count || e.works)
            }),
            e
        }
        var d, h, f, p = t('#predictions_script[type="text/x-handlebars-template"]', i), 
        // m = t('#futurologists_script[type="text/x-handlebars-template"]', i), 
        g = t('#emptyplaceholder_script[type="text/x-handlebars-template"]', i), v = p.parent(), 
        // _ = m.parent(), 
        b = 1, k = n.compile(p.html()), 
        w = n.compile(''), 
        y = n.compile(g.html()), x = "";
        i.on("click", "a", function(n) {
            if ("#" === t(this).attr("href").substr(0, 1)) {
                var i = a.hash;
                e.modal(),
                t(o.documentElement).one("modal:hide", function() {
                    a.hash = i
                })
            }
        }),
        t(function() {
            function e(e) {
                e.preventDefault(),
                a = "",
                s.val(a),
                o()
            }
            function n(e) {
                e.preventDefault(),
                a = t(this).find(".predictions__search-input").val(),
                o()
            }
            function o() {
                clearTimeout(r),
                l(a)
            }
            var a, r, s = i.find(".predictions__search-input");
            i.find(".predictions__search-reset").on("click", e),
            i.find(".predictions__search").on("submit", n)
        }),
        this.init = function(e) {
            e && (d = e,
            l())
        }
    }
    function s(e, n) {
        var i = !!e == !!n
          , e = e || t(".load__column")
          , n = n || 8
          , o = e.find(".load--hidden")
          , a = e.find(".load__item").not(".load--hidden");
        i && a.length || o.length && o.slice(0, 8).removeClass("load--hidden")
    }
    function c(e) {
        e = e || t(".load__column"),
        e.each(function() {
            var e = t(this).find(".load-more");
            t(this).find(".load--hidden").length ? e.show().addClass("show") : e.hide().removeClass("show")
        })
    }
    t.fn.predictions = function(n) {
        this.each(function() {
            var i = t(this)
              , a = function() {
                var e = i.data("predictions");
                e || i.data("predictions", e = new r(i));
                var n = t(".radio-column").on("click", function() {
                    n.removeClass("active"),
                    t(this).addClass("active");
                    var e = t(this).is(".listpredictions");
                    t(".predictions__column.listpredictions").toggleClass("active", e),
                    t(".predictions__column.futurologists").toggleClass("active", !e)
                });
                return e
            }()
              , l = i.find(".scroll__masked").scrollbarCustom().data("scrollCustom");
            t.when(a.ready).then(l.refresh),
            i.on("modal-item:show  modal-item:hide", function(e) {
                i.find(".scroll").trigger(e.type.replace("modal-item", "scroll")),
                l.refresh(),
                t(o.documentElement).trigger("resize:after")
            }),
            i.one("modal-item:show", function() {
                a.init(n)
            }).on("modal-item:show", function() {
                var e = i.find(".checkbox-nth:checked");
                e.length > 0 && (e = i.find(".checkbox-nth").eq(0).prop("checked", !0)),
                i.find("label[for=" + e.attr("id") + "]").click()
            }),
            i.find(".load-more").on("click", function(e) {
                e.preventDefault();
                var n = t(this).closest(".load__column");
                s(n),
                c(n),
                n.trigger("items:show"),
                l.refresh()
            }),
            i.find(".load__column").on("items:loaded", function() {
                var n = t(this);
                s(n),
                c(n),
                l.refresh(),
                e.checkMobile.css.isMobile() && n.trigger("items:show")
            }),
            i.find(".load__column").on("items:show", function() {
                e.checkMobile.css.isMobile() && t(this).closest(".checkbox-nth-container").css("height", i.find(".load__column.active").outerHeight() + "px")
            }),
            t(o.documentElement).on("resize:after", function() {
                l.refresh(),
                e.checkMobile.css.isMobile() && i.find(".load__column").closest(".checkbox-nth-container").css("height", i.find(".load__column.active").outerHeight() + "px")
            })
        })
    }
}(peppers = peppers || {}, jQuery, Handlebars, window, document, window.location),
function(e, t, n) {
    function i(i) {
        function o(i) {
            i.preventDefault(),
            s(c.serialize()).done(function() {
                t.modal(),
                n.alert(e.fn.localization.getText("add_prediction.success") || "ADD SUCCESS")
            }).fail(function(e) {
                n.alert(e)
            })
        }
        function a() {
            i.find(".form").blink()
        }
        function r() {}
        var s, c = i.find("form").on("form:submit", o);
        i.on("modal-item:show", a).on("modal-item:hide", r),
        this.init = function(e) {
            s = e || s
        }
    }
    e.fn.addPrediction = function(t) {
        this.each(function() {
            var n = e(this)
              , o = n.data("add-prediction");
            o || n.data("add-prediction", o = new i(n)),
            o.init(t)
        })
    }
}(jQuery, peppers = peppers || {}, app = app || {});
var peppers, app;
!function(e, t, n) {
    function i(e) {
        function i(e) {
            e.preventDefault(),
            r(s.serialize()).done(function() {
                n.user.accept_terms(),
                t.modal()
            }).fail(function(e) {
                n.alert(e)
            })
        }
        function o() {
            e.find(".form").blink()
        }
        function a() {}
        var r, s = e.find("form").on("form:submit", i);
        e.on("modal-item:show", o).on("modal-item:hide", a),
        this.init = function(e) {
            r = e || r
        }
    }
    e.fn.termsAccepted = function(t) {
        this.each(function() {
            var n = e(this)
              , o = n.data("terms-accepted");
            o || n.data("terms-accepted", o = new i(n)),
            o.init(t)
        })
    }
}(jQuery, peppers = peppers || {}, app = app || {});
var peppers, app;
!function(e, t, n) {
    function i(i) {
        function o(i) {
            i.preventDefault(),
            s(c.serialize()).done(function() {
                t.modal(),
                n.alert(e.fn.localization.getText("feedback.success") || "FEEDBACK SUCCESS")
            }).fail(function(e) {
                n.alert(e)
            })
        }
        function a() {
            i.find(".form").blink()
        }
        function r() {}
        var s, c = i.find("form").submit(o);
        i.on("modal-item:show", a).on("modal-item:hide", r),
        this.init = function(e) {
            s = e || s
        }
    }
    e.fn.feedback = function(t) {
        this.each(function() {
            var n = e(this)
              , o = n.data("feedback");
            o || n.data("feedback", o = new i(n)),
            o.init(t)
        })
    }
}(jQuery, peppers = peppers || {}, app = app || {});
var peppers, app;
!function(e, t, n, i) {
    function o(o) {
        function a() {
            r || s || "alert" !== n.hash.getHash()[1] || n.modal()
        }
        var r, s, c = this, l = o.find(".modal-message__title"), u = o.find(".modal-message__body");
        e(t).on("hashchange", a),
        i.alert = function(t, i, o) {
            "already voted: agree" == t ? t = e.fn.localization.getText("voted.agree") || "already voted: agree" : "already voted: disagree" == t && (t = e.fn.localization.getText("voted.disagree") || "already voted: disagree"),
            c.init(t, i),
            n.modal("alert", o || location.hash)
        }
        ,
        this.init = function(e, t) {
            l.html(r = e || ""),
            u.html(s = t || ""),
            a()
        }
    }
    e.fn.alert = n.jQueryConstructor("alert", o)
}(jQuery, window, peppers = peppers || {}, app = app || {});
var peppers, app;
!function(e, t) {
    function n() {
        var t = o();
        e(".authorization").toggleClass("authorization_authorized", !!t),
        e(".predictions__likes").toggleClass("visible", !!t),
        e(".predictions__rank").toggleClass("visible", !!t)
    }
    var i, o;
    e.fn.authorization = function(a) {
        return o = a || o,
        !i && this.length > 0 && (i = !0,
        e(t).on("login:change", n),
        n()),
        this
    }
}(jQuery, window),
function(e, t, n) {
    e.fn.FAQ2 = function() {
        var t = this
          , i = t.find(".scroll__masked").scrollbarCustom().data("scrollCustom");
        t.on("modal-item:show", function() {
            t.localization()
        }),
        t.localization().done(function() {
            var o = e.fn.localization.getText("faq_qa");
            if (o)
                try {
                    "string" == typeof o && (o = JSON.parse(o))
                } catch (e) {
                    o = []
                }
            t.each(function() {
                var t = e(this)
                  , i = t.find("[type='text/x-handlebars-template']")
                  , a = n.compile(i.html());
                i.after(a(o))
            }),
            i.refresh()
        })
    }
}(jQuery, 0, Handlebars),
function(e, t, n) {
    e.fn.terms = function() {
        var t = this
          , i = t.find(".scroll__masked").scrollbarCustom().data("scrollCustom");
        t.on("modal-item:show", function() {
            t.localization()
        }),
        t.localization().done(function() {
            var o = e.fn.localization.getText("terms");
            if (o)
                try {
                    "string" == typeof o && (o = JSON.parse(o))
                } catch (e) {
                    o = []
                }
            t.each(function() {
                var t = e(this)
                  , i = t.find("[type='text/x-handlebars-template']")
                  , a = n.compile(i.html());
                i.after(a(o))
            }),
            i.refresh()
        })
    }
}(jQuery, 0, Handlebars),
function(e, t, n) {
    function i(e, t) {
        var n = new FileReader;
        n.onload = function(e) {
            var n = new DataView(e.target.result);
            if (65496 != n.getUint16(0, !1))
                return t(-2);
            for (var i = n.byteLength, o = 2; o < i; ) {
                var a = n.getUint16(o, !1);
                if (o += 2,
                65505 == a) {
                    if (1165519206 != n.getUint32(o += 2, !1))
                        return t(-1);
                    var r = 18761 == n.getUint16(o += 6, !1);
                    o += n.getUint32(o + 4, r);
                    var s = n.getUint16(o, r);
                    o += 2;
                    for (var c = 0; c < s; c++)
                        if (274 == n.getUint16(o + 12 * c, r))
                            return t(n.getUint16(o + 12 * c + 8, r))
                } else {
                    if (65280 != (65280 & a))
                        break;
                    o += n.getUint16(o, !1)
                }
            }
            return t(-1)
        }
        ,
        n.readAsArrayBuffer(e.slice(0, 65536))
    }
    function o(o) {
        function a(e) {
            var n = t.getFiles(e)[0];
            n && i(n, function(e) {
                s = e,
                r(n, s)
            })
        }
        function r(i, a) {
            function r(e, n) {
                l = n,
                t.Image(i).rotate(c[a]).resize(u.preview.width, u.preview.height, "min").get(function(e, t) {
                    e || (h.off("user-pic-crop:save").userPicCrop(t, o.data("title")).on("user-pic-crop:save", s),
                    d.val(""))
                })
            }
            function s(e, n) {
                var r = n.height * l.height / (n.width * l.width)
                  , s = Math.max(0, n.x)
                  , u = Math.max(0, n.y)
                  , d = Math.max(0, Math.min(n.width, 1 - n.x, n.width + n.x))
                  , h = Math.max(0, Math.min(n.height, 1 - n.y, n.height + n.y))
                  , f = d / n.width
                  , p = h / n.height;
                t.Image(i).rotate(c[a]).crop(s * l.width, u * l.height, d * l.width, h * l.height).get(function(e, t) {
                    if (!e) {
                        var i = document.createElement("canvas")
                          , a = i.width = Math.min(1e3, Math.max(t.width, t.height / r))
                          , s = i.height = a * r;
                        i.getContext("2d").drawImage(t, 0, 0, t.width, t.height, a * (n.x < 0 ? 1 - f : 0), s * (n.y < 0 ? 1 - p : 0), a * f, s * p),
                        o.trigger("upload-image:crop", i)
                    }
                })
            }
            var l, h = e(".user-pic-crop");
            h.is(":visible") || peppers.modal("user-pic-crop", n.hash),
            t.getInfo(i, r)
        }
        var s = 1
          , c = {
            8: 270,
            3: 180,
            6: 90,
            7: 270,
            4: 180,
            5: 90
        }
          , l = peppers.checkMobile.css.isMobile() ? 484 : 333
          , u = {
            preview: {
                width: l,
                height: l
            }
        }
          , d = e('<input class="upload-image__input" name="photo" type="file" accept=".jpg,.jpeg,.png" />');
        o.append(d),
        t.event && t.event.on(d.get(0), "change", a),
        this.init = function(t, n) {
            switch (t) {
            case "upload":
                break;
            case "init":
                n && (u = e.extend(u, n))
            }
        }
    }
    e.fn.uploadImage = function(t, n) {
        return 1 === arguments.length && (n = t,
        t = "init"),
        this.each(function() {
            var i = e(this)
              , a = i.data("upload-image");
            a || i.data("upload-image", a = new o(i)),
            a.init(t, n)
        })
    }
}(jQuery, FileAPI, window.location),
function(e, t, n) {
    function i(i) {
        function a(e) {
            var t = i.find(e);
            return function(e) {
                o(t, e)
            }
        }
        function r(e) {
            var n = i.find(e);
            return function(e) {
                o(n, t.formatNumber(e || 0))
            }
        }
        var s = this;
        s.element = i,
        this.elements = {
            image: function(e) {
                var t = i.find(e);
                return function(e) {
                    o(t, e, !0, function() {
                        t.closest(".user-pic").addClass("user-pic--visible")
                    })
                }
            }(".user-data__userpic"),
            name: a(".user-data__username"),
            total_likes: r(".user-data__total-likes"),
            rank: r(".user-data__total-rank"),
            location: a(".user-data__location"),
            email: a(".user-data__email"),
            about: a(".user-data__about")
        },
        e(n).on("login:change", function() {
            s.update()
        })
    }
    function o(t, n, i, o) {
        n = n || "",
        t.each(function() {
            var t = e(this);
            switch (!0) {
            case t.is("input"):
            case t.is("textarea"):
                t.val(n);
                break;
            default:
                t.closest(".user-panel__stat-item").toggleClass("user-panel__stat-item_empty", !n && 0 !== n),
                i ? t.css("background-image", "url('" + n + "')") : t.html(n),
                "function" == typeof o && o()
            }
        })
    }
    e.fn.userData = t.jQueryConstructor("UserData", i),
    i.prototype.init = function(e) {
        if ("function" == typeof e)
            this.api = e;
        else
            var t = e;
        this.update(t)
    }
    ,
    i.prototype.update = function(e) {
        if (void 0 === e || (e.user.suadmin,
        0) ? window.suadmin = !1 : window.suadmin = !0,
        this.api || e) {
            e = e || this.api();
            for (var t in this.elements)
                this.elements.hasOwnProperty(t) && this.elements[t](e && e.user && e.user[t] || "");
            this.element.trigger("user-data:change")
        }
    }
}(jQuery, peppers = peppers || {}, document);
var peppers;
!function(e, t, n, i, o) {
    function a(e) {
        e.works.forEach(function(e) {
            e.link = app.addwork_link("", e.id),
            e.view_link = app.brief_link(e.brief && e.brief.id || e.brief_id, 1, e.id),
            e.likes = e.likes || 0
        });
        var t = e && e.predictions;
        return e.predictions.forEach(function(t, n) {
            if (t.works_count <= 1 && (e.predictions[n].works_count_1 = !0,
            e.predictions[n].works_count_2 = !1,
            e.predictions[n].works_count_3 = !1),
            2 == t.works_count && (e.predictions[n].works_count_1 = !1,
            e.predictions[n].works_count_2 = !0,
            e.predictions[n].works_count_3 = !1),
            t.works_count > 2 && (e.predictions[n].works_count_1 = !1,
            e.predictions[n].works_count_2 = !1,
            e.predictions[n].works_count_3 = !0),
            0 == t.works_count) {
                var i = {
                    first: ""
                };
                i.first = "/frontend/images/default-preview.png",
                e.predictions[n].image = i
            }
        }),
        e.predictions = t,
        e
    }
    function r(e) {
        var t = e.find(".scroll__masked")
          , i = t.data("scrollCustom");
        i || (i = t.scrollbarCustom().data("scrollCustom"),
        n(o.documentElement).on("resize:after", i.refresh)),
        i.refresh()
    }
    function s(i) {
        var o = this.$el = n(i)
          , a = new t.compile(o.find("#my-discussions").html());
        this.prediction = new c(o.find(".discussions"),a),
        this.works = new c(o.find(".uploaded-works"),a),
        r(o),
        o.find(".checkbox-nth").on("change", function() {
            if (e.checkMobile.css.isMobile()) {
                var t = n(this).parent()
                  , i = t.find(".checkbox-nth")
                  , o = i.index(this)
                  , a = t.find(".checkbox-nth-item")
                  , r = a.eq(o);
                a.toggleClass("my-discussion_hide", !0),
                r.toggleClass("my-discussion_hide", !1)
            }
        }),
        this.elements = {
            userEdit: n(".user-edit"),
            totalLikes: n(".user-panel__total-likes"),
            totalAgrees: n(".user-panel__total-agrees"),
            totalDisagrees: n(".user-panel__total-disagrees"),
            totalPredictions: n(".user-panel__total-predictions"),
            totalLikesText: n(".likes_howMuch"),
            totalPredictionsText: n(".predictions_howMuch"),
            totalRank: n(".user-panel__total-rank"),
            userData: o.find(".user-panel__user-data")
        }
    }
    function c(t, a) {
        function r(e) {
            function t(e) {
                app.alert(e),
                a.css("pointer-events", "")
            }
            function i() {
                "function" == typeof v && v(),
                a.animate({
                    opacity: 0,
                    top: -10,
                    height: 0,
                    padding: 0
                }, 200, function() {
                    a.remove(),
                    _ = _.not(a),
                    u(b)
                }),
                n(o.documentElement).trigger("resize:after")
            }
            var a = n(this).closest("[data-id]");
            a.css("pointer-events", "none");
            var r = {};
            r[w.name + "_id"] = a.data("id"),
            g(r).done(i).fail(t)
        }
        function s() {
            n(_).filter(".my-discussion_hide").length ? y.addClass("paginator--show") : y.removeClass("paginator--show")
        }
        function c() {
            e.checkMobile.css.isMobile() || (m = t.offset().top,
            p = y.offset().top,
            _ && _.length > 0 && _.data("bottom", void 0)),
            u(b)
        }
        function l() {
            C++,
            u()
        }
        function u(n, i) {
            if (y.removeClass("paginator_no-next paginator_no-prev"),
            _ && _.removeClass("my-discussion_hide"),
            x.toggle(!(_ && _.length > 0)),
            !(_ && _.length > 0))
                return void M.hide();
            n >= _.length && (n = _.length,
            i = !0),
            e.checkMobile.css.isMobile() ? d() : (M.hide(),
            h(n, i)),
            s(),
            t.trigger("checkbox:change")
        }
        function d() {
            var e = !1;
            if (_) {
                var t = 10 * C;
                e = t < _.length,
                _.each(function(e) {
                    n(this).toggleClass("my-discussion_hide", e >= t)
                })
            }
            M.toggle(e)
        }
        function h(e, t) {
            var i, o = 0, a = n(""), r = b = e;
            if (t)
                for (; r-- > 0; )
                    i = _.eq(r),
                    (o += i.outerHeight()) < p - m && (b = r,
                    a = a.add(i));
            for (r = e; r < _.length; r++)
                i = _.eq(r),
                (o += i.outerHeight()) < p - m && (k = r,
                a = a.add(i));
            a.removeClass("my-discussion_hide"),
            _.not(a).addClass("my-discussion_hide"),
            y.toggleClass("paginator_no-next", k >= _.length - 1),
            y.toggleClass("paginator_no-prev", b <= 0)
        }
        function f() {
            switch (n(this).data("direction")) {
            case "-1":
            case -1:
                b > 0 && (k = b - 1,
                u(b, !0));
                break;
            case "1":
            case 1:
                k < _.length - 1 && u(k + 1)
            }
        }
        var p, m, g, v, _, b, k, w = this, y = t.siblings(".paginator"), x = t.find(".user-panel__placeholder"), C = 1, M = t.siblings(".load-more").on("click", l);
        y.find(".paginator__button").click(f),
        n(i).on("resize:after", c),
        t.on("click", ".close-button", r),
        this.init = function(e, i, o, r) {
            w.name = o,
            i && (g = i,
            v = r),
            _ && _.off().data("bottom", void 0).remove().localization("destroy"),
            e.length > 0 && (_ = n(a(e)).appendTo(t),
            _.localization("en"),
            _ = _.find(".list__item")),
            u(b = 0)
        }
    }
    t.registerHelper("not-approved", function(e) {
        return this.status && "approved" !== this.status || this.inactive ? e.fn(this) : e.inverse(this)
    }),
    n.fn.userPanel = function(e, t, i, o, r) {
        var c, l = !!r && r.user.suadmin;
        this.each(function() {
            function r() {
                d.init(c = e({
                    user_id: o || ""
                }, a), !1)
            }
            var u = n(this)
              , d = u.data("userPanel");
            d || u.data("userPanel", d = new s(this)),
            (void 0 === app.user.getData() || app.user.getData() && app.user.getData().user && app.user.getData().user.id && o && parseInt(o) !== app.user.getData().user.id) && (u.find(".add-prediction-btn").hide(),
            u.find(".add-work-btn").hide()),
            u.toggleClass("user-panel_my", l || !o),
            u.toggleClass("user-panel_other", l ? !l : !!o),
            n(".authorization").toggleClass("authorization_other", !!o),
            d.init(c = c || e({
                user_id: o || ""
            }, a), t, i, r),
            o && l && u.find(".user-panel__edit_profile").hide()
        })
    }
    ,
    s.prototype.init = function(e, i, a, r) {
        var s = this;
        e.done(function(e) {
            n(".authorization__user-info_lk").userData(e),
            s.elements.userData.userData(e),
            !1 !== i && (s.prediction.init(e.predictions, a, "brief"),
            s.works.init(e.works, i, "work", r)),
            s.elements.totalLikes.html(e.total_likes),
            s.elements.totalAgrees.html(e.total_agrees + "+"),
            s.elements.totalDisagrees.html(e.total_disagrees + "-"),
            s.elements.totalPredictions.html(e.total_predictions),
            s.elements.totalLikesText.attr("data-localization", "lk.likes_count" + t.helpers.howMuch(e.total_likes)),
            s.elements.totalPredictionsText.attr("data-localization", "lk.predictions_count" + t.helpers.howMuch(e.total_predictions)),
            s.elements.totalRank.html(e.rank),
            n(o.documentElement).trigger("resize:after"),
            app.set_metadata({
                title: e.user.name,
                description: e.user.about,
                og_title: e.user.name,
                og_description: e.user.about,
                og_image: e.user.image_share,
                og_url: e.user.share_url
            })
        })
    }
}(peppers = peppers || {}, Handlebars, jQuery, window, document);
var peppers;
!function(e, t) {
    function n(t) {
        function n() {
            d.toggleClass("button_inactive", c.serialize() === l)
        }
        function i() {
            l = c.serialize(),
            d.addClass("button_inactive")
        }
        function o(t) {
            t.preventDefault(),
            e(this).is(".button_inactive") || r(c.serializeArray()).done(function() {
                peppers.modal()
            }).then(function() {
                e(document.documentElement).trigger("resize:after")
            })
        }
        function a(e, i) {
            peppers.modal();
            var o = i.toDataURL("image/jpeg");
            s.val(o),
            t.find(".user-pic__image").css("backgroundImage", "url('" + o + "')"),
            n()
        }
        var r;
        t.find(".upload-image").on("upload-image:crop", a);
        var s = e('[name="userpic"]')
          , c = t.find(".user-edit__form").on("form:submit", o);
        c.find("input, textarea").on("change click keyup", n);
        var l, u = t.find(".user-data"), d = t.find(".button");
        u.on("user-data:change", i),
        i(),
        this.init = function(e) {
            r = e
        }
    }
    e.fn.userEdit = function(t) {
        this.each(function() {
            var i = e(this)
              , o = i.data("user-edit");
            o || i.data("user-edit", o = new n(i)),
            o.init(t)
        })
    }
}(jQuery, window.location),
function(e, t, n) {
    function i(i) {
        function o() {}
        function a(t, n) {
            e(".user-edit .upload-image").trigger(t, n)
        }
        function r(e) {
            var t = C.offset()
              , n = C.outerWidth()
              , i = C.outerHeight()
              , o = c(e, "client")
              , a = t.left + n / 2 - o.x
              , r = t.top + i / 2 - o.y
              , s = Math.sqrt(a * a + r * r);
            _.css("fontSize", Math.max(100, Math.min(_.height(), 2 * s * 370 / 426)))
        }
        function s(e) {
            M && M.css(y = l(e))
        }
        function c(e, t) {
            var n = e.touches && e.touches[0] || e;
            return t = t || "page",
            {
                x: n[t + "X"],
                y: n[t + "Y"]
            }
        }
        function l(e) {
            if (e) {
                var t = c(e);
                t.x -= v.x,
                t.y -= v.y
            } else
                t = {
                    x: 0,
                    y: 0
                };
            return {
                left: w.left + t.x,
                right: w.right - t.x,
                top: w.top + t.y,
                bottom: w.bottom - t.y
            }
        }
        function u(n) {
            m = "scale",
            n.preventDefault(),
            _.on("mousemove touchmove", r),
            e(t).on("mouseup  touchend", d)
        }
        function d(n) {
            _.off("mousemove touchmove", r).off("mousemove touchmove", s),
            e(t).off("mouseup  touchend", d),
            "move" === m && (w = y)
        }
        function h(n) {
            n.isDefaultPrevented() || (m = "move",
            n.preventDefault(),
            v = c(n),
            _.on("mousemove touchmove", s),
            e(t).on("mouseup  touchend", d))
        }
        function f() {
            if (M) {
                C.css("borderWidth", 0);
                var e = function(e, t) {
                    var n = {
                        offset: e.offset(),
                        width: e.width(),
                        height: e.height()
                    }
                      , i = {
                        offset: t.offset(),
                        width: t.width(),
                        height: t.height()
                    };
                    return {
                        x: (n.offset.left - i.offset.left) / i.width,
                        y: (n.offset.top - i.offset.top) / i.height,
                        width: n.width / i.width,
                        height: n.height / i.height
                    }
                }(C, M);
                C.css("borderWidth", Math.abs(g)),
                i.trigger("user-pic-crop:save", e)
            }
        }
        function p() {}
        var m, g = -2e3, v = {}, _ = i.find(".user-pic-crop__image"), b = i.find(".hexagon__in2"), k = i.find(".user-pic-crop__title");
        e(".user-pic-crop__dot", _).on("touchstart  mousedown", u),
        e(".user-pic-crop__save", i).on("click", f),
        _.on("touchstart  mousedown", h);
        var w, y, x = i.find(".select-file").uploadImage().on("upload-image:crop", a), C = i.find(".user-pic-crop__mask-hex").css({
            left: g,
            right: g,
            top: g,
            bottom: g,
            borderWidth: Math.abs(g)
        });
        i.on("modal-item:hide", p),
        e(t).on("hashchange", o);
        var M;
        this.init = function(t, o) {
            if (x.data("title", o),
            k.toggle(!!o),
            o && k.html(e.fn.localization.getText(o || "")),
            !t)
                return M && M.off().remove(),
                M = void 0,
                !1;
            n.modal("user-pic-crop"),
            i.toggleClass("user-pic-crop_edit", !!(t && !0 !== t || M)),
            !0 !== t && (M && M.off().remove(),
            M = t && e(t).appendTo(b).addClass("user-pic-crop__target"),
            w = {
                left: g,
                right: g,
                top: g,
                bottom: g
            },
            s(),
            _.css("fontSize", ""))
        }
    }
    e.fn.userPicCrop = n.jQueryConstructor("user-pic-crop", i)
}(jQuery, window, peppers = peppers || {});
var peppers;
!function(e, t, n) {
    function i(e, n, i) {
        function o() {
            a.ui.trigger(s)
        }
        var a = this;
        a._checked = !1,
        a.ui = t(e(n)).insertAfter(i).click(o),
        a.ui.localization("en"),
        a.countUI = a.ui.find(".agree-vote__count"),
        a.count(n.count),
        this.init = function() {}
    }
    function o(e) {
        function t(e, t) {
            var n = new i(u,e,t || l);
            return n.ui.on(s, o),
            n
        }
        function o() {
            e.trigger(r, c.yes.ui.is(this))
        }
        var c = this
          , l = e.find('[type="text/x-handlebars-template"]')
          , u = n.compile(l.html());
        e.on(a, function(e) {
            c.yes.checked(void 0),
            c.no.checked(void 0)
        }),
        this.yes = t({
            position: "left",
            count: 0,
            agree: !0
        }),
        this.no = t({
            position: "right",
            count: 0,
            agree: !1
        }, this.yes.ui)
    }
    var a = "vote:cancel"
      , r = "vote:vote"
      , s = "vote-item:select"
      , c = "agree-vote__content"
      , l = c + "_checked"
      , u = c + "_unchecked";
    t.fn.agreeVote = e.jQueryConstructor("agreeVote", o),
    i.prototype.checked = function(e) {
        if (0 == arguments.length)
            return this._checked;
        switch (this._checked = e,
        this.ui.removeClass(l + " " + u),
        e) {
        case !0:
            this.ui.addClass(l);
            break;
        case !1:
            this.ui.addClass(u)
        }
    }
    ,
    i.prototype.count = function(e) {
        if (0 == arguments.length)
            return this._count;
        this.countUI.html(this._count = e)
    }
    ,
    o.prototype.init = function(e) {
        if (e) {
            if (this.yes.count(e.agree),
            this.no.count(e.disagree),
            ["agree", "disagree"].indexOf(e.voted) >= 0)
                var t = "agree" === e.voted
                  , n = "disagree" === e.voted;
            this.yes.checked(t),
            this.no.checked(n)
        }
    }
}(peppers = peppers || {}, jQuery, Handlebars);
var peppers;
!function(e, t, n, i) {
    function o(e) {
        function n(a) {
            if (a && a.preventDefault(),
            !t.user.isAuthorized())
                return void t.user.auth(n);
            var c = t.mapToHash(u.serializeArray());
            return r(i.extend({
                brief_id: s
            }, c)).done(function() {
                e.trigger("add-comment-form:add", c.comment),
                o(),
                u.pristine()
            }),
            !1
        }
        function o() {
            e.removeClass("add-comment-form_expanded"),
            e.trigger("scroll:do_refresh")
        }
        function a() {
            e.is(".add-comment-form_expanded") || t.user.isAuthorized() ? (e.toggleClass("add-comment-form_expanded"),
            e.trigger("scroll:do_refresh")) : t.user.auth(a)
        }
        var r, s, c = e.find(".add-comment-form__header"), l = e.find(".reply-comment__cancel"), u = e.find("form");
        c.click(a),
        l.click(o),
        u.on("submit", n),
        this.init = function(e, t) {
            r = e || r,
            s = t
        }
    }
    i.fn.pristine = function() {
        this.find("input, textarea").each(function() {
            i(this).val("")
        }),
        this.find("input, textarea").each(function() {
            var e = i(this);
            e.val(e.attr("value") || "")
        })
    }
    ,
    i.fn.addCommentForm = e.jQueryConstructor("addCommentForm", o)
}(peppers = peppers || {}, app = app || {}, window, jQuery);
var peppers, app;
!function(e, t, n) {
    function i(e) {
        this.script = e.find('[type="text/x-handlebars-template"]'),
        this.template = n.compile(this.script.html())
    }
    t.fn.briefCommentsList = e.jQueryConstructor("briefCommentsList", i),
    i.prototype.init = function(e, n) {
        switch (e) {
        case "add":
            var i = t(this.template([n])).find(".brief-comment");
            this.$comments.append(i);
            break;
        default:
            this.$comments && this.$comments.remove(),
            e && (this.$comments = t(this.template(e)).insertAfter(this.script),
            this.$comments.localization("en"))
        }
    }
}(peppers = peppers || {}, jQuery, Handlebars);
var peppers;
!function(e, t, n) {
    function i(e) {
        this.script = e.find('[type="text/x-handlebars-template"]'),
        this.template = n.compile(this.script.html())
    }
    n.registerHelper("ifAuthor", function(e, t, n) {
        return 2 === arguments.length && (n = t),
        e && e.name && e.image ? n.fn(this) : n.inverse(this)
    }),
    t.fn.briefModalContent = e.jQueryConstructor("briefModalContent", i),
    i.prototype.init = function(e) {
        e && (this.ui && this.ui.remove(),
        this.ui = t(this.template(e)).insertAfter(this.script),
        this.ui.find(".user-pic").addClass("user-pic--visible").find(".user-data__userpic").css("background-image", "url('" + (e.author && e.author.image) + "')"))
    }
}(peppers = peppers || {}, jQuery, Handlebars);
var peppers;
!function(e, t, n) {
    function i() {
        var e;
        try {
            e = new ActiveXObject("Msxml2.XMLHTTP")
        } catch (t) {
            try {
                e = new ActiveXObject("Microsoft.XMLHTTP")
            } catch (t) {
                e = !1
            }
        }
        return e || "undefined" == typeof XMLHttpRequest || (e = new XMLHttpRequest),
        e
    }
    function o(e) {
        var t = i();
        t.open("GET", e, !1),
        t.send(null)
    }
    function a() {
        var e = c.is(":checked");
        $(".k-menu .backdrop").toggleClass("backdrop_visible", e),
        s.trigger("menu:" + (e ? "show" : "hide")).trigger("menu:toggle"),
        $(".k-menu").toggleClass("k-menu_visible", e)
    }
    function r() {
        var t = e.hash.getHash();
        c.prop("checked", !1).change(),
        $(".nav-menu__link").each(function() {
            var n = $(this)
              , i = n.attr("href");
            n.toggleClass("nav-menu__link_selected", e.hash.isEqual(t, e.hash.getHash(i)))
        })
    }
    $(t).on("hashchange", r).on("resize", a);
    var s = $(n.documentElement)
      , c = $("#k-menu-toggle").on("change", a);
    $(".nav-menu__link_lang").on("click", function(e) {
        e.preventDefault(),
        e.stopPropagation(),
        $(this).data("lang") && (o("/backend/api/v1/set/" + $(this).data("lang")),
        parent.php_passed_lang = $(this).data("lang"),
        php_passed_lang = $(this).data("lang"),
        localStorage.language = $(this).data("lang"));
        var n = t.location.hash;
        "#" == n && (n = "");
        var i = "";
        if ("ru" == $(this).data("lang"))
            i = t.location.origin + "/ru" + t.location.pathname + t.location.search + n;
        else {
            if (-1 != location.href.indexOf("/ru#/"))
                var a = "/" + t.location.pathname.split("/ru")[1];
            else
                var a = "/" + t.location.pathname.split("/ru/")[1];
            i = t.location.origin + a + t.location.search + n
        }
        return t.location.replace(i),
        !1
    })
}(peppers = peppers || {}, window, document);
var peppers;
!function(e, t) {
    function n(e) {
        function t(e) {
            return e.replace(/[A-Z]/g, function() {
                return "_" + arguments[0].toLowerCase()
            })
        }
        return function(e) {
            var n = {};
            for (var i in e) {
                for (var o = i.split("_"), a = n, r = t(o[0]), s = 0; s < o.length - 1; s++) {
                    var c = r;
                    r = t(o[s + 1]),
                    a = a[c] = a[c] || (/^\d+$/.test(r) ? [] : {})
                }
                a[r] = e[i]
            }
            return n
        }(e)
    }
    function i(n, i) {
        var a = e(n)
          , r = o(i, a.data("localization"));
        void 0 !== r && (r.hasOwnProperty("attr") && a.attr(r.attr),
        ["string", "number"].indexOf(typeof r) >= 0 ? a.html(r) : r.hasOwnProperty("length") ? a = function() {
            if (a.is("script"))
                var n = a.html();
            else {
                n = "{{#each this}}" + a.get(0).outerHTML + "{{/each}}";
                var i = !0
            }
            var o = t.compile(n)(r);
            a.after(o),
            i && (a.remove(),
            e(o).removeAttr("data-localization"))
        }() : (r.hasOwnProperty("desktop") || r.hasOwnProperty("mobile")) && function() {
            a.html("<span class='mobile-only'>" + r.mobile + "</span><span class='desktop-only'>" + r.desktop + "</span>")
        }())
    }
    function o(e, t) {
        for (var n = t.split("."); e && n.length > 0; )
            e = e[n.shift()];
        return e
    }
    var a, r, s = {}, c = {}, l = [];
    e.fn.localization = function(t, o) {
        function u(e) {
            e.done(d)
        }
        function d(e) {
            r = e,
            f.find("[data-localization]").each(function() {
                l.push(new i(this,e))
            }),
            h.resolve()
        }
        if ("destroy" !== t) {
            t = t || "en";
            var h = e.Deferred()
              , f = this;
            return o && (a = o),
            a || s[t] ? (s[t] = s[t] || a(t, n),
            c[t] && c[t].resolve(s[t]),
            s[t].done(d)) : (c[t] || (c[t] = e.Deferred()),
            c[t].then(u)),
            h.promise()
        }
    }
    ,
    e.fn.localization.getText = function(e, t) {
        if (r)
            return o(r, e)
    }
}(jQuery, window.Handlebars),
function(e, t, n, i) {
    e.fn.welcome = function() {
        function o() {
            c.remove(),
            l.resolve()
        }
        function a(e, n) {
            function i(t) {
                if (!0 === t || !f) {
                    var n = !0 === t ? 0 : u.data("duration") - 0;
                    m.each(r(0, 1, n || 0 === n ? n : s[e] || 1, 0, l))
                }
            }
            function l() {
                a(++e, .2)
            }
            function h() {
                f || (m.each(function() {
                    t.killTweensOf(this)
                }),
                f = !0,
                i(!0))
            }
            var f;
            if (d = h,
            e >= u.length)
                return void c.fadeOut(o);
            var p = u.eq(e).show()
              , m = p.find(".welcome__l");
            n = n || 0,
            m.css("opacity", 0).each(r(1, .5, n, .025, i))
        }
        function r(e, o, a, r, s) {
            var c = 0;
            return function(l) {
                c++,
                t.to(this, o, {
                    opacity: e,
                    delay: a + r * l,
                    ease: n.ease.config({
                        template: i.easeNone,
                        strength: 2,
                        points: 10,
                        taper: "none",
                        randomize: !0,
                        clamp: !0
                    }),
                    onComplete: function() {
                        0 == --c && "function" == typeof s && s()
                    }
                })
            }
        }
        var s = [1, 6, 3]
          , c = this
          , l = e.Deferred();
        if (0 === this.length || e.cookie("visited"))
            o();
        else {
            e.cookie("visited", "1", {
                expires: 3650,
                path: "/"
            });
            var u = this.find(".welcome__text").each(function() {
                var t = e(this).children()
                  , n = t.html();
                n = n.split("").map(function(e) {
                    return "<span  class='welcome__l'>" + e + "</span>"
                }),
                t.html(n.join(""))
            });
            a(0, 1)
        }
        var d;
        return this.on("click", function() {
            d()
        }),
        l.promise()
    }
}(jQuery, TweenLite, RoughEase, Power0),
function(e, t, n, i, o, a, r) {
    function s() {
        if (x.brief_id)
            var e = c("brief")({
                brief_id: x.brief_id
            });
        if (x.work_id)
            var r = c("work")({
                work_id: x.work_id
            });
        t.planetMain && t.planetMain(c("locations"), c("location")),
        o(".user-data").userData(C.getData),
        o(".authorization").authorization(C.getData),
        o(".authorization").toggleClass("authorization_user-panel", /user-panel/.test(a.pathname)),
        o(".authorization").toggleClass("authorization_add-prediction", /add-prdiction/.test(a.hash)),
        o(".search").search(c("search")),
        o(".login").loginModal(C.login, C.register, C.restore, C.changePassword),
        o(".scroll").scrollCustom(),
        o(".best-of-week").bestOfWeek(c("top")),
        o(".user-panel").userPanel(c("user"), c("work-delete", void 0, !1, "DELETE"), c("brief-delete", void 0, !1, "DELETE"), x.user_id, C.getData()),
        o(".ratings").ratings(c("ratings")),
        o(".modal__ui.predictions").predictions(c("search")),
        o(".add-prediction").addPrediction(c("brief-add")),
        o(".terms-accepted").termsAccepted(c("accept-terms")),
        o(".feedback").feedback(c("feedback")),
        o(".upload-image").uploadImage(),
        o(".user-edit").userEdit(C.edit),
        o(".brief-360").brief(c("works"), c("work-add_like", void 0, !1, "POST"), c("brief")),
        o(".brief-modal").briefModal(c("brief"), c("comment-add"), c("agree", void 0, !1, "post"), C.getData),
        o(".faq-2").FAQ2(),
        o(".terms").terms(),
        o(".faq, .faq-2, .terms, .feedback, .add-prediction, .terms-accepted, .about, .login, .user-edit, .user-panel").on("modal-item:show", function() {
            var e = o(this).find(".scroll__masked")
              , t = e.data("scrollCustom");
            t || (t = e.scrollbarCustom().data("scrollCustom"),
            o(i.documentElement).on("resize:after", t.refresh)),
            t.refresh()
        }),
        o(".modal__ui.search").on("modal-item:show", function() {
            o(".modal__close-button").addClass("modal__close-button_top")
        }),
        o(".modal__ui.search").on("modal-item:hide", function() {
            o(".modal__close-button").removeClass("modal__close-button_top")
        }),
        o(".modal__ui.predictions").on("modal-item:show", function() {
            o(".modal__close-button").removeClass("modal__close-button_top")
        }),
        o(".user-pic-crop").userPicCrop(),
        o(".modal:not(.modal_static) .modal-message").alert(),
        o(".hexagonal-map").hexagonalMap(c("location")),
        "undefined" != typeof InstallTrigger && o(".close-button-hexagon, .back-btn-svg").hexButton(),
        o(function() {
            if ("function" == typeof o.fn.addwork) {
                var t = o.Deferred();
                r ? r.done(function(e) {
                    t.resolve({
                        work: e,
                        brief: e.brief
                    })
                }) : e ? e.done(function(e) {
                    t.resolve({
                        brief: e
                    })
                }) : a.href = "/404.html",
                o(".addwork").addwork(t.promise(), c("work-save"), c("search"))
            }
        }),
        o(function() {
            function t(e) {
                e = e || ~~o.cookie(n) || i[i.length - 1 >> 1],
                o(".timeline").pepTimeline(i, e).on("timeline:change", function(e, t) {
                    o.cookie(n, t, {
                        path: "/",
                        expires: new Date(3e3,0,1)
                    })
                }).trigger("timeline:init")
            }
            var n = "selectedYear"
              , i = [2030, 2040, 2050];
            e ? e.done(function(e) {
                t(e.year)
            }) : t()
        });
        var s = "en";
        void 0 !== w && (s = w),
        t.ready.addWait(o(i.body).localization(s, c("localization"))),
        m.resolve(),
        t.ready.done(function() {
            h(),
            o(n).trigger("hashchange").resize()
        })
    }
    function c(e, t, i, a, r) {
        function s(t, n, i) {
            return o.get("api_example/" + e + ".json")
        }
        function c(e) {
            var t = o.cookie("test_api");
            if ("1" === t)
                return !0;
            try {
                for (var n = JSON.parse(t), i = 0; i < n.length; i++)
                    if (n[i].name === e)
                        return "1" == n[i].value
            } catch (e) {}
            return !1
        }
        function l(e, t, n, i) {
            i = i || !1,
            r = void 0 === r || Boolean(r);
            var a = {
                method: n || "GET",
                async: r
            };
            if (i) {
                var s = new FormData;
                for (key in t)
                    t.hasOwnProperty(key) && s.append(key, t[key]);
                a.processData = !1,
                a.contentType = !1,
                a.cache = !1,
                a.data = s
            } else
                a.data = t;
            var c = o.ajax(e, a);
            return c.then(function(e) {
                return e._token && o.ajaxSetup({
                    headers: {
                        "X-CSRF-TOKEN": e._token
                    }
                }),
                e
            }),
            c
        }
        function u() {
            f.hasOwnProperty(e) && f[e]()
        }
        function d() {
            var e = arguments;
            return function() {
                "function" == typeof ga && ga.apply(n, e)
            }
        }
        var h, f = {
            agree: d("send", "event", "Button1", "Click2"),
            "work-add_like": d("send", "event", "Button2", "Click")
        }, p = {
            restore: "user/restore",
            "change-password": "user/change-password",
            "accept-terms": "user/accept-terms",
            location: "location/{location_id}",
            locations: "locations",
            brief: "brief/{brief_id}",
            "brief-add": "brief/add",
            "brief-delete": "brief/{brief_id}/delete",
            "comment-add": "brief/{brief_id}/comment",
            works: "brief/{brief_id}/works",
            "work-save": "brief/{brief_id}/works/add",
            agree: "brief/{brief_id}/{agree}",
            top: "brief/top",
            work: "work/{work_id}",
            "work-add_like": "work/{work_id}/like",
            "work-delete": "work/{work_id}/delete",
            "comment-delete": "comment/{comment_id}/delete",
            logout: "user/logout",
            login: "user/login",
            register: "user/register",
            user: "user/{user_id}",
            useredit: "user/edit",
            search: "search/{filter}",
            ratings: "ratings",
            feedback: "feedback",
            predictions: "predictions",
            localization: "localization",
            set: "set/{lang}",
            get: "get"
        }, m = l, g = "work-save" == e;
        return h = "/backend/api/v1/" + (p.hasOwnProperty(e) ? p[e] : ""),
        function(n, r, l) {
            function d(e, t) {
                for (var n in e)
                    if (e.hasOwnProperty(n))
                        if (t || /^(?:image|photo|preview|flag|url)s?$/.test(n))
                            switch (typeof e[n]) {
                            case "string":
                                /^backend\//.test(e[n]) && (e[n] = "/" + e[n]);
                                break;
                            case "object":
                                d(e[n], !0)
                            }
                        else
                            "object" == typeof e[n] && d(e[n]);
                return e
            }
            function f(e) {
                switch (!0) {
                case "string" == typeof e:
                    w.reject(e);
                    break;
                case !1 === e.success:
                    var t = e.text || e.message || e.error;
                    w.reject(t);
                    break;
                case e.hasOwnProperty("error"):
                    w.reject(e.text || e.error);
                    break;
                case e.hasOwnProperty("errors"):
                    var n = [];
                    for (var i in e.errors)
                        n.push(e.errors[i].join(", "));
                    w.reject(n.join("<br>"));
                    break;
                case e[0] && !1 === e[0].success:
                    w.reject(e[0].message);
                    break;
                default:
                    u(),
                    w.resolve(e)
                }
            }
            var v = h;
            if ("localization" === e && (n = void 0),
            k.hasOwnProperty(v))
                return k[v];
            n && p[e] && (v = v.replace(/\/\{([^\}]+)\}/g, function() {
                var e = arguments[1];
                if (n.hasOwnProperty(e)) {
                    var t = n[e];
                    return delete n[e],
                    t ? "/" + t : ""
                }
                return ""
            }));
            var _;
            switch (typeof n) {
            case "object":
                for (var b in n)
                    if (n.hasOwnProperty(b)) {
                        _ = n;
                        break
                    }
                break;
            default:
                _ = n
            }
            var w = o.Deferred()
              , y = w.promise();
            return (c(e) ? s : m)(v, _, l || a || (_ ? "post" : "get"), g).then(function(t) {
                return "localization" !== e ? d(t) : t
            }).then(t).then(r).done(function(e) {
                f(e)
            }).fail(function(e) {
                e.responseJSON ? f(e.responseJSON) : w.reject(e.message || e.responseText || "ERROR")
            }),
            !0 === i && (k[h] = y,
            y.fail(function() {
                delete k[h]
            })),
            y
        }
    }
    function l(e) {
        if (C.getData())
            return !0;
        var n, i = a.pathname;
        switch (!0) {
        case /\/user-panel/.test(i) && !(x && x.user_id):
            n = e && e.user && e.user.id && t.user_link(e.user.id);
            break;
        case /\/addwork/.test(i):
            n = "";
            break;
        default:
            return !0
        }
        return t.navigateTo(n || "/"),
        !1
    }
    function u(r, s, c, l, u, d, h, f) {
        function p() {
            return "_" + ("" + Math.random()).substr(2)
        }
        function m(e) {
            e.preventDefault(),
            w.logout()
        }
        function g(t) {
            "string" == typeof t ? b = JSON.parse(k = t) : k = JSON.stringify(b = t),
            _(b);
            var n = w.getData();
            o(i).trigger("login:change", n),
            o(i.body).off("click", "[data-authorization-required]", v),
            t || o(i.body).on("click", "[data-authorization-required]", v);
            var a = e.hash.getHash();
            ("modal" !== a[0] || "modal" === a[0] && "terms" !== a[1]) && n && n.user && !1 === n.user.terms_accepted && e.modal("terms-accepted")
        }
        function v(e) {
            var t = o(this);
            w.isAuthorized() || (e ? (e.preventDefault(),
            w.auth(function() {
                t.click()
            })) : w.auth())
        }
        function _() {
            if (0 == arguments.length) {
                try {
                    var e = JSON.parse(n.localStorage.getItem("user_info") || o.cookie("USER_INFO"))
                } catch (e) {}
                return e
            }
            if (void 0 !== arguments[0]) {
                var t = JSON.stringify(arguments[0]);
                try {
                    n.localStorage.setItem("user_info", t)
                } catch (e) {
                    o.cookie("USER_INFO", t, {
                        path: "/",
                        expires: new Date(3e3,0,1)
                    })
                }
            } else
                n.localStorage.removeItem("user_info"),
                o.cookie("USER_INFO", "", {
                    path: "/",
                    expires: -1
                })
        }
        o(i).on("click  logout", ".logout, [href='#/logout']", m);
        var b, k, w = this;
        w.accept_terms = function() {
            var e = JSON.parse(n.localStorage.getItem("user_info") || o.cookie("USER_INFO"));
            e.user.terms_accepted = !0,
            k = JSON.stringify(e),
            n.localStorage.setItem("user_info", k)
        }
        ,
        w.register = function(n) {
            var i = o.Deferred();
            return s(n).done(function() {
                i.resolve(),
                e.modal(),
                t.alert(o.fn.localization.getText("sign_up.success"))
            }).fail(function(e) {
                i.reject(e)
            }),
            i.promise()
        }
        ,
        w.restore = function(n) {
            var i = o.Deferred();
            return c(n).done(function() {
                i.resolve(),
                e.modal(),
                t.alert(o.fn.localization.getText("restore.success"))
            }).fail(function(e) {
                i.reject(e)
            }),
            i.promise()
        }
        ,
        w.changePassword = function(n) {
            var i = o.Deferred();
            return l(n).done(function() {
                e.modal(),
                t.alert(o.fn.localization.getText("restore.change.success"), "", "/#/modal/login")
            }).fail(function(e) {
                i.reject(e)
            }),
            i.promise()
        }
        ,
        w.login = function(t) {
            var n = o.Deferred();
            return r(t).done(function(t) {
                g(t),
                n.resolve();
                var i = w.getData()
                  , o = e.hash.getHash();
                ("modal" !== o[0] || "modal" === o[0] && "terms" !== o[1]) && i && i.user && !1 === i.user.terms_accepted && e.modal("terms-accepted")
            }).fail(function(e) {
                n.reject(e)
            }),
            n.promise()
        }
        ,
        w.login.social = function(e) {
            function t(e) {
                try {
                    "string" == typeof e && (e = atob(e))
                } catch (e) {}
                g(e),
                r.resolve(),
                i()
            }
            function i() {
                clearInterval(l),
                delete n[s];
                try {
                    delete c.onbeforeunload,
                    delete c.onunload
                } catch (e) {}
            }
            var r = o.Deferred()
              , s = p();
            n[s] = t;
            var c = n.open(a.origin + "/backend/api/v1/user/login/fb?cb=" + s, "_blank", "toolbar=0,status=0,width=626,height=436")
              , l = setInterval(function() {
                c && !c.closed || i()
            }, 500);
            return r.promise()
        }
        ,
        w.logout = function() {
            function e() {
                t.navigateTo("/")
            }
            var n;
            !function() {
                n = w.getData(),
                g(void 0)
            }(),
            h().done(e).fail(function(t) {
                "user not found" === t && e()
            })
        }
        ,
        w.getData = function() {
            return k && JSON.parse(k)
        }
        ,
        w.auth = function(t) {
            e.modal("login", [a.hash, function() {
                "function" == typeof t && w.isAuthorized() && t()
            }
            ])
        }
        ,
        w.isAuthorized = function() {
            return !!w.getData()
        }
        ,
        w.edit = function(e) {
            for (var t = o.Deferred(), n = w.getData(), i = {}, a = 0; a < e.length; a++)
                i[e[a].name] = e[a].value;
            return u(i).then(function() {
                t.resolve(),
                n = o.extend(n, {
                    user: {
                        name: i.username,
                        email: i.email,
                        location: i.location,
                        about: i.about,
                        image: i.userpic
                    }
                }),
                g(n),
                o(".user-panel__user-data").userData(n)
            }).fail(function(e) {
                t.reject(e)
            }),
            t.promise()
        }
        ,
        w.authRequired = function(e) {
            v(null)
        }
        ,
        g(_()),
        d({
            user_id: ""
        }).done(function(e) {
            e.user.hasOwnProperty("rank") || (e.user.rank = e.rank),
            g(e)
        }).fail(function(e) {
            /on line \d+ of|LK\.php$/.test(e) || g(void 0)
        })
    }
    function d() {
        function e() {
            o.cookie("visited-2", "1", {
                expires: 3650,
                path: "/"
            }),
            o(this).off("mousedown  touchstart", e),
            o(".help").fadeOut()
        }
        if (!o.cookie("visited-2")) {
            o(".help").fadeIn().parent().on("mousedown  touchstart", e)
        }
    }
    function h() {
        o(".welcome").welcome().done(d)
    }
    function f(e) {
        return e.replace(/^\w+:\/\/[^\/]+/, "")
    }
    function p(e) {
        return e && e.replace(/^\s+|\s+$/g, "")
    }
    var m = t.ready.addWait()
      , g = o(i)
      , v = o(n)
      , _ = o(i.documentElement)
      , b = o(i.body)
      , k = {};
    !function() {
        !function() {
            r.registerHelper("switch", function(e, t) {
                this._switch_value_ = e;
                var n = p(t.fn(this));
                return delete this._switch_value_,
                n
            }),
            r.registerHelper("case", function(e, t) {
                return e == this._switch_value_ ? t.fn(this) : ""
            })
        }(),
        function() {
            r.registerHelper("brief_link", function(e, t) {
                var n = this.brief_id || this.brief && this.brief.id || this.id;
                return this.works_count > 0 || !0 === this.works ? "brief.html?brief_id=" + n : "#/modal/brief/" + n
            })
        }(),
        function() {
            r.registerHelper("user_link", function(e, t) {
                return "user-panel.html?user_id=" + this.id
            })
        }(),
        function() {
            r.registerHelper("json", function(e, t) {
                return "<pre>" + JSON.stringify(e, null, "\t") + "</pre>"
            })
        }(),
        function() {
            r.registerHelper("ifCond", function(e, t, n) {
                return e === t ? n.fn(this) : n.inverse(this)
            })
        }(),
        function() {
            r.registerHelper("isSingle", function(e) {
                return 1 !== e ? "" : "_single"
            })
        }(),
        function() {
            r.registerHelper("howMuch", function(e) {
                var t;
                t = 2 == e.toString().length && 1 == e.toString().substr(-2, 1) ? 5 : e.toString().substr(-1),
                t = t.toString();
                var n;
                switch (t) {
                case "1":
                    n = "_quant1";
                    break;
                case "2":
                case "3":
                case "4":
                    n = "_quant2";
                    break;
                case "5":
                case "6":
                case "7":
                case "8":
                case "9":
                case "0":
                default:
                    n = "_quant5"
                }
                return n
            })
        }()
    }(),
    function() {
        o.fn.blink = function() {
            this.children().not(".login__form").add(this.find(".login__form > *")).css({
                opacity: 0
            }).each(function(e) {
                TweenLite.to(this, .5, {
                    opacity: 1,
                    delay: .5 + .5 * Math.random(),
                    ease: RoughEase.ease.config({
                        template: Power0.easeNone,
                        strength: 2,
                        points: 20 + 20 * Math.random(),
                        taper: "none",
                        randomize: !0,
                        clamp: !0
                    })
                })
            })
        }
    }(),
    function() {
        t.get_metadata = function() {
            return {
                title: o("title").html(),
                description: o('meta[name="description"]').attr("content"),
                og_title: o('meta[property="og:title"]').attr("content"),
                og_description: o('meta[property="og:description"]').attr("content"),
                og_image: o('meta[property="og:image"]').attr("content"),
                og_url: o('meta[property="og:url"]').attr("content")
            }
        }
        ,
        t.set_metadata = function(e) {
            o("title").html(e.title),
            o('meta[name="description"]').attr("content", e.description),
            o('meta[property="og:title"]').attr("content", e.og_title),
            o('meta[property="og:description"]').attr("content", e.og_description),
            o('meta[property="og:image"]').attr("content", e.og_image),
            o('meta[property="og:url"]').attr("content", e.og_url)
        }
        ,
        t.brief_link = function(e, t, n) {
            var i = t > 0 || !0 === t;
            "object" == typeof e && (i = e.works_count > 0 || !0 === e.works || e.works && e.works.length > 0,
            n = e.work_id,
            e = e.brief_id || e.id);
            var o = n ? "#/" + n : "";
            return i ? "brief.html?brief_id=" + e + o : "#/modal/brief/" + e
        }
        ,
        t.addwork_link = function(e, t) {
            var n = [];
            return e && n.push("brief_id=" + e),
            t && n.push("work_id=" + t),
            "addwork.html?" + n.join("&")
        }
        ,
        t.user_link = function(e) {
            return "user-panel.html" + (e ? "?user_id=" + e : "")
        }
        ,
        t.mapToHash = function(e) {
            for (var t = {}, n = 0; e && n < e.length; n++)
                t[e[n].name] = e[n].value;
            return t
        }
        ,
        t.parseURL = function(e) {
            function n(e) {
                var t = e.split("=");
                return {
                    name: t.shift(),
                    value: t.join("=")
                }
            }
            var i = a.search.substr(1)
              , o = i.split("&");
            if (0 == arguments.length)
                return o.map(n);
            if (!0 === e)
                return t.mapToHash(o.map(n));
            for (var r = 0; r < o.length; r++) {
                var s = n(o[r]);
                if (s.name === e)
                    return s.value
            }
        }
    }(),
    function() {
        function e(e, t) {
            var n = e.data("scrollTop");
            t ? (void 0 === n && (n = _.scrollTop()),
            e.css({
                top: -n,
                position: "fixed",
                width: "100%"
            })) : (e.css({
                top: "",
                position: "",
                width: ""
            }),
            "number" == typeof n && _.scrollTop(n),
            e.data("scrollTop", void 0))
        }
        _.on("modal:toggle  menu:toggle  best-of-week:toggle", function(t) {
            var n = o(".backdrop").is(":visible");
            e(o(".content-app"), n);
            var i = o(".modal .backdrop").is(":visible")
              , a = o(".k-menu .backdrop").is(":visible");
            e(o(".modal"), a),
            e(o(".best-of-week"), a || i)
        })
    }(),
    function() {
        function t() {
            requestAnimationFrame(n)
        }
        function n() {
            function t(e, t) {
                o("[" + e + "]").each(function() {
                    var n = o(this);
                    n.toggleClass(n.attr(e), t)
                })
            }
            var n = v.width()
              , i = v.height()
              , r = "boolean" == typeof a ? !a : e.checkMobile.css.isLandscape();
            b.is(".is_vr") && (r = !r);
            var s = e.checkMobile.css.isMobile()
              , c = {};
            switch (!0) {
            case r:
                c = {
                    w: 1135,
                    h: 640
                };
                break;
            case s:
            case e.checkMobile.isMobileOrTablet():
                c = {
                    w: 640,
                    h: 1135
                };
                break;
            default:
                c = {
                    w: 1280,
                    h: 720
                }
            }
            _.css("fontSize", 18 * Math.min(1, n / c.w)),
            _.toggleClass("landscape", r);
            var l = {
                width: n,
                height: i
            };
            _.data("size", l).trigger("resize:after", l),
            t("data-mobile-class", s),
            t("data-desktop-class", !s)
        }
        v.resize(t),
        o(i.body).on("vr:change", n);
        var a
    }();
    var w = "en";
    if ("/" == n.location.pathname && "" == n.location.hash) {
        if (void 0 === localStorage.language && (localStorage.language = "en"),
        "ru" == (w = localStorage.language)) {
            var y = n.location.origin + "/ru/" + n.location.search;
            c("set")({
                lang: "ru"
            }),
            n.location.replace(y)
        }
    } else
        w = -1 != a.href.indexOf("/ru") ? "ru" : "en",
        localStorage.language = w,
        c("set", void 0, !1, "", !1)({
            lang: w
        });
    i.documentElement.setAttribute("lang", w),
    o(".nav-menu__link").removeClass("nav-menu__link_inactive"),
    o('.nav-menu__link[data-lang="' + w + '"]').addClass("nav-menu__link_inactive"),
    n.meta_default = {},
    n.meta_brief = {},
    n.meta_user = {},
    "en" == w ? (o("title").html("Earth 2050"),
    o('meta[name="description"]').attr("content", "Take a look at the future of the world through the eyes of renowned futurologists"),
    o('meta[property="og:title"]').attr("content", "Earth 2050"),
    o('meta[property="og:description"]').attr("content", "Take a look at the future of the world through the eyes of renowned futurologists"),
    n.meta_default.title = "Earth 2050",
    n.meta_default.descr = "Take a look at the future of the world through the eyes of renowned futurologists",
    o(".lang_en_only").removeClass("hidden")) : (o("title").html("Земля 2050"),
    o('meta[name="description"]').attr("content", "Взгляните на будущее мира глазами знаменитых футурологов"),
    o('meta[property="og:title"]').attr("content", "Земля 2050"),
    o('meta[property="og:description"]').attr("content", "Взгляните на будущее мира глазами знаменитых футурологов"),
    n.meta_default.title = "Земля 2050",
    n.meta_default.descr = "Взгляните на будущее мира глазами знаменитых футурологов",
    o(".lang_ru_only").removeClass("hidden")),
    n.meta_default.img = "http://" + n.location.hostname + "/images/share/fb.png";
    var x = t.parseURL(!0);
    x.restore_code && (o(".login__change-password [name='code']").val(x.restore_code),
    e.modal("login/change-password"),
    history.pushState(null, null, n.location.href.replace(n.location.search, "")));
    var C = new u(c("login"),c("register"),c("restore"),c("change-password"),c("useredit"),c("user"),c("logout"),l);
    t.user = C,
    l() && (g.ready(s),
    function() {
        function e() {
            for (var e = r(); d.length > 0; ) {
                var o = i();
                if (!s(e, o, "#"))
                    return l = !0,
                    void t.navigateTo(n.location.origin + o);
                d.pop()
            }
            t.navigateTo("/")
        }
        function i() {
            return d.length > 0 ? f(d[d.length - 1]) : ""
        }
        function r() {
            return [a.pathname, a.search, a.hash].join("")
        }
        function s(e, t, n) {
            return n = n || "#",
            e.split(n)[0] == t.split(n)[0]
        }
        function c() {
            d = d.splice(-10),
            o.cookie(u, JSON.stringify(d), {
                path: "/"
            })
        }
        var l;
        o.cookie("history", "", {
            expires: -1
        });
        var u = "kav_history"
          , d = JSON.parse(o.cookie(u) || "[]");
        o(n).on("unload", function() {
            var e = r()
              , t = i();
            l || (s(e, t) ? d[d.length - 1] = e : d.push(e)),
            c()
        }),
        n.historyBack = e,
        g.on("click", ".prev-page", e)
    }())
}(peppers = peppers || {}, app = app || {}, window, document, jQuery, window.location, Handlebars);
var app, peppers;
!function(e, t, n, i) {
    function o() {
        var e;
        try {
            e = new ActiveXObject("Msxml2.XMLHTTP")
        } catch (t) {
            try {
                e = new ActiveXObject("Microsoft.XMLHTTP")
            } catch (t) {
                e = !1
            }
        }
        return e || "undefined" == typeof XMLHttpRequest || (e = new XMLHttpRequest),
        e
    }
    function a() {
        function e(e, t) {
            if (!t)
                return e || "";
            if (e)
                for (var n = e.substr(1).split("&"), i = 0; i < n.length; i++) {
                    var o = n[i].split("=");
                    t.hasOwnProperty(o[0]) || (t[o[0]] = o.slice(1).join("="))
                }
            n = [];
            for (var a in t)
                n.push(a + "=" + t[a]);
            return n.length > 0 ? "?" + n.join("&") : ""
        }
        var t = n(this)
          , o = t.data("href");
        o || t.data("href", o = i.compile(t.attr("href")));
        var a = top.location
          , s = a.origin || a.protocol + "//" + a.host + (a.port && [80, 443].indexOf(a.port) < 0 ? ":" + a.port : "")
          , c = /share__item_(fb|tw)/.exec(this.className);
        c = c && c[1] ? {
            s: c[1]
        } : {};
        var l = /^#\/modal\/brief\/(\d+)/.exec(a.hash)
          , u = !1;
        l || (u = /\/brief.*\?brief_id=(\d+)/.exec(a.href));
        var d = /^#\/modal\/ratings/.exec(a.hash)
          , h = /\/user-panel.*?user_id=(\d+)/.exec(a.href);
        if ("en" == r)
            ;
        else
            ;location.protocol,
        location.hostname;
        u || (d ? (s = s + "/" + e("", c) + "&lang=" + r,
        location.protocol,
        location.hostname) : l ? (c.brief_id = l[1],
        s = s + a.pathname + e(a.search, c) + "&lang=" + r + "#/modal/brief/" + l[1],
        location.protocol,
        location.hostname) : h && (s = s + a.pathname + e(a.search, c) + "&lang=" + r,
        location.protocol + "//" + location.hostname + "/images/share_images/user.jpg")),
        t.attr("href", o({
            location: encodeURIComponent(s)
        }))
    }
    var r = "en"
      , s = t.locale = t.locale || new n.Deferred;
    !function(e) {
        var t = o();
        if (t.open("GET", e, !1),
        t.send(null),
        200 == t.status) {
            var n = JSON.parse(t.responseText);
            s.resolve(r = n.locale)
        }
    }("/backend/api/v1/get/"),
    n(e.documentElement).on("click", ".share a", function(e) {
        if (e.preventDefault(),
        n(this).hasClass("share__item_fb")) {
            var i = (n('meta[property="og:title"]').attr("content"),
            n('meta[property="og:description"]').attr("content"))
              , o = location.href
              , s = (n('meta[property="og:image"]').attr("content"),
            n('meta[property="og:url"]').attr("content"));
            return t.FB && (s.match(/brief|work|user/i) ? FB.ui({
                method: "share",
                href: s
            }, function(e) {}) : FB.ui({
                method: "share",
                href: t.location.protocol + "//" + t.location.host + "/backend/share/index?loc=" + r
            }, function(e) {})),
            !1
        }
        var i = (n('meta[property="og:title"]').attr("content"),
        n('meta[property="og:description"]').attr("content"))
          , o = location.href
          , c = (n('meta[property="og:image"]').attr("content"),
        "http://twitter.com/share?");
        c += "text=" + encodeURIComponent(i),
        c += "&url=" + encodeURIComponent(o),
        c += "&counturl=" + encodeURIComponent(o);
        var l = n(t)
          , u = l.width()
          , d = l.height();
        t.open(c, "", "toolbar=0,status=0,width=" + Math.min(u, Math.max(1200, .5 * u)) + ",height=" + Math.min(d, Math.max(436, .5 * d))),
        a.call(this)
    }),
    n(".share__item").each(a)
}(document, window, jQuery, Handlebars);
